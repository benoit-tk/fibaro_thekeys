{"name":"The Keys","type":"virtual_device","properties":{"deviceIcon":1008,"currentIcon":"0","log":"","logTemp":"","mainLoop":"--[[\n%% properties\n%% globals\n--]]\n\nlocal identifier = \"\"\nlocal code = \"\"\n\nlocal lockeropenid\nlocal lockercloseid\n\n\nfunction addGlobalValue(nom, valeur)\n  \tif(fibaro:getGlobalValue(nom) ~= nil) then\n    \tfibaro:setGlobal(nom, valeur)\n    else\n      local res ,status, err = Net.FHttp(\"127.0.0.1\",11111):POST('/api/globalVariables', \n          '{\"name\":\"'..nom..'\", \"value\":\"'..valeur..'\"}')\n    \n      if (tonumber(status) == 200 and tonumber(err)==0) then \n          fibaro:debug(\"Global variable \"..nom..\" created\"); \n      else\n          fibaro:debug(\"Fail to register global variable: \"..status..\". err: \"..err)\n      end\n    end\nend\n\nif not fibaro:getGlobal('lockeridentifier'..fibaro:getSelfId()) or fibaro:getGlobal('lockeridentifier'..fibaro:getSelfId()) == \"\" then\n  addGlobalValue('lockeridentifier'..fibaro:getSelfId(), identifier)\n  addGlobalValue('locker_code'..fibaro:getSelfId(), code)\n  fibaro:debug(\"set variable: \"..'locker_identifier'..fibaro:getSelfId()..\" = \"..identifier)\nelse\n  fibaro:debug(\"identifier already set.\")\nend\n\n--Find icons id for buttons.\nif not fibaro:getGlobalValue('locker_close_id') then\n  local res ,status, err = Net.FHttp(\"127.0.0.1\",11111):GET('/api/devices/'..fibaro:getSelfId());\n  if (tonumber(status) == 200 and tonumber(err)==0) then \n      response = json.decode(res)\n      for i = 1, #response.properties.rows do   \n          for j = 1, #response.properties.rows[i].elements do\n              if response.properties.rows[i].elements[j].name == \"ButtonOpen\" then\n          \t\t  lockeropenid = response.properties.rows[i].elements[j].buttonIcon\n                  fibaro:debug(\"Found button open: \"..lockeropenid)\n                  addGlobalValue('locker_open_id_'..fibaro:getSelfId(), lockeropenid)\n              elseif response.properties.rows[i].elements[j].name == \"ButtonClose\" then\n          \t\t  lockercloseid = response.properties.rows[i].elements[j].buttonIcon\n                  fibaro:debug(\"Found button close: \"..response.properties.rows[i].elements[j].buttonIcon)\n                  addGlobalValue('locker_close_id'..fibaro:getSelfId(), response.properties.rows[i].elements[j].buttonIcon)\n              end\n              --fibaro:debug(response.properties.rows[i].elements[j].name)\n          end\n      end\n  else\n      fibaro:debug(\"Fail to get device \"..fibaro.getSelfId())\n  end \nend\n\n\nlocal sha256 = { }\n\nlocal MOD = 2 ^ 32\nlocal MODM = MOD - 1\n \n \nfunction floor(n) \n  return n - (n % 1)\nend\n\nfunction bxor1 (a,b)\n  local r = 0\n  for i = 0, 31 do\n    local x = a / 2 + b / 2\n    if x ~= floor(x) then\n      r = r + 2^i\n    end\n    a = floor(a / 2)\n    b = floor(b / 2)\n  end\n  return r\nend \n \nlocal function bxor(a, b, c, ...)\n\tlocal z = nil\n\tif b then\n\t\ta = a % MOD\n\t\tb = b % MOD\n\t\tz = bxor1(a, b)\n\t\tif c then z = bxor(z, c, ...) end\n\t\treturn z\n\telseif a then\n\t\treturn a % MOD\n\telse\n\t\treturn 0\n\tend\nend\n \nlocal function band(a, b, c, ...)\n\tlocal z\n\tif b then\n\t\ta = a % MOD\n\t\tb = b % MOD\n\t\tz =((a + b) - bxor1(a, b)) / 2\n\t\tif c then z = bit32_band(z, c, ...) end\n\t\treturn z\n\telseif a then\n\t\treturn a % MOD\n\telse\n\t\treturn MODM\n\tend\nend\n \nlocal function bnot(x) return(-1 - x) % MOD end\n \nlocal function rshift1(a, disp)\n\tif disp < 0 then return lshift(a, - disp) end\n\treturn math.floor(a % 2 ^ 32 / 2 ^ disp)\nend\n \nlocal function rshift(x, disp)\n\tif disp > 31 or disp < -31 then return 0 end\n\treturn rshift1(x % MOD, disp)\nend\n \nlocal function lshift(a, disp)\n\tif disp < 0 then return rshift(a, - disp) end\n\treturn(a * 2 ^ disp) % 2 ^ 32\nend\n \nlocal function rrotate(x, disp)\n\tx = x % MOD\n\tdisp = disp % 32\n\tlocal low = band(x, 2 ^ disp - 1)\n\treturn rshift(x, disp) + lshift(low, 32 - disp)\nend\n \nlocal k = {\n\t0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,\n\t0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,\n\t0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,\n\t0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,\n\t0xe49b69c1,0xefbe4786,0x0fc19dc6,0x240ca1cc,\n\t0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,\n\t0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,\n\t0xc6e00bf3,0xd5a79147,0x06ca6351,0x14292967,\n\t0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,\n\t0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,\n\t0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,\n\t0xd192e819,0xd6990624,0xf40e3585,0x106aa070,\n\t0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,\n\t0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,\n\t0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,\n\t0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2,\n}\n \nlocal function str2hexa(s)\n\treturn(string.gsub(s, \".\", function(c) return string.format(\"%02x\", string.byte(c)) end))\nend\n \nlocal function num2s(l, n)\n\tlocal s = \"\"\n\tfor i = 1, n do\n\t\tlocal rem = l % 256\n\t\ts = string.char(rem) .. s\n\t\tl =(l - rem) / 256\n\tend\n\treturn s\nend\n \nlocal function s232num(s, i)\n\tlocal n = 0\n\tfor i = i, i + 3 do n = n * 256 + string.byte(s, i) end\n\treturn n\nend\n \nlocal function preproc(msg, len)\n\tlocal extra = 64 -((len + 9) % 64)\n\tlen = num2s(8 * len, 8)\n\tmsg = msg .. \"\\128\" .. string.rep(\"\\0\", extra) .. len\n\tassert(#msg % 64 == 0)\n\treturn msg\nend\n \nlocal function initH256(H)\n\tH[1] = 0x6a09e667\n\tH[2] = 0xbb67ae85\n\tH[3] = 0x3c6ef372\n\tH[4] = 0xa54ff53a\n\tH[5] = 0x510e527f\n\tH[6] = 0x9b05688c\n\tH[7] = 0x1f83d9ab\n\tH[8] = 0x5be0cd19\n\treturn H\nend\n \nlocal function digestblock(msg, i, H)\n\tlocal w = { }\n\tfor j = 1, 16 do w[j] = s232num(msg, i +(j - 1) * 4) end\n\tfor j = 17, 64 do\n\t\tlocal v = w[j - 15]\n\t\tlocal s0 = bxor(rrotate(v, 7), rrotate(v, 18), rshift(v, 3))\n\t\tv = w[j - 2]\n\t\tw[j] = w[j - 16] + s0 + w[j - 7] + bxor(rrotate(v, 17), rrotate(v, 19), rshift(v, 10))\n\tend\n\n\tlocal a, b, c, d, e, f, g, h = H[1], H[2], H[3], H[4], H[5], H[6], H[7], H[8]\n\tfor i = 1, 64 do\n\t\tlocal s0 = bxor(rrotate(a, 2), rrotate(a, 13), rrotate(a, 22))\n\t\tlocal maj = bxor(band(a, b), band(a, c), band(b, c))\n\t\tlocal t2 = s0 + maj\n\t\tlocal s1 = bxor(rrotate(e, 6), rrotate(e, 11), rrotate(e, 25))\n\t\tlocal ch = bxor(band(e, f), band(bnot(e), g))\n\t\tlocal t1 = h + s1 + ch + k[i] + w[i]\n\t\th, g, f, e, d, c, b, a = g, f, e, d + t1, c, b, a, t1 + t2\n\tend\n\n\tH[1] = band(H[1] + a)\n\tH[2] = band(H[2] + b)\n\tH[3] = band(H[3] + c)\n\tH[4] = band(H[4] + d)\n\tH[5] = band(H[5] + e)\n\tH[6] = band(H[6] + f)\n\tH[7] = band(H[7] + g)\n\tH[8] = band(H[8] + h)\nend\n\nlocal function hex_to_binary(hex)\n\treturn hex:gsub('..', function(hexval)\n\t\treturn string.char(tonumber(hexval, 16))\n\tend )\nend\n\nlocal blocksize = 64 -- 512 bits\n\nlocal xor_with_0x5c = {\n\t[string.char(0)] = string.char(92),\n\t[string.char(1)] = string.char(93),\n\t[string.char(2)] = string.char(94),\n\t[string.char(3)] = string.char(95),\n\t[string.char(4)] = string.char(88),\n\t[string.char(5)] = string.char(89),\n\t[string.char(6)] = string.char(90),\n\t[string.char(7)] = string.char(91),\n\t[string.char(8)] = string.char(84),\n\t[string.char(9)] = string.char(85),\n\t[string.char(10)] = string.char(86),\n\t[string.char(11)] = string.char(87),\n\t[string.char(12)] = string.char(80),\n\t[string.char(13)] = string.char(81),\n\t[string.char(14)] = string.char(82),\n\t[string.char(15)] = string.char(83),\n\t[string.char(16)] = string.char(76),\n\t[string.char(17)] = string.char(77),\n\t[string.char(18)] = string.char(78),\n\t[string.char(19)] = string.char(79),\n\t[string.char(20)] = string.char(72),\n\t[string.char(21)] = string.char(73),\n\t[string.char(22)] = string.char(74),\n\t[string.char(23)] = string.char(75),\n\t[string.char(24)] = string.char(68),\n\t[string.char(25)] = string.char(69),\n\t[string.char(26)] = string.char(70),\n\t[string.char(27)] = string.char(71),\n\t[string.char(28)] = string.char(64),\n\t[string.char(29)] = string.char(65),\n\t[string.char(30)] = string.char(66),\n\t[string.char(31)] = string.char(67),\n\t[string.char(32)] = string.char(124),\n\t[string.char(33)] = string.char(125),\n\t[string.char(34)] = string.char(126),\n\t[string.char(35)] = string.char(127),\n\t[string.char(36)] = string.char(120),\n\t[string.char(37)] = string.char(121),\n\t[string.char(38)] = string.char(122),\n\t[string.char(39)] = string.char(123),\n\t[string.char(40)] = string.char(116),\n\t[string.char(41)] = string.char(117),\n\t[string.char(42)] = string.char(118),\n\t[string.char(43)] = string.char(119),\n\t[string.char(44)] = string.char(112),\n\t[string.char(45)] = string.char(113),\n\t[string.char(46)] = string.char(114),\n\t[string.char(47)] = string.char(115),\n\t[string.char(48)] = string.char(108),\n\t[string.char(49)] = string.char(109),\n\t[string.char(50)] = string.char(110),\n\t[string.char(51)] = string.char(111),\n\t[string.char(52)] = string.char(104),\n\t[string.char(53)] = string.char(105),\n\t[string.char(54)] = string.char(106),\n\t[string.char(55)] = string.char(107),\n\t[string.char(56)] = string.char(100),\n\t[string.char(57)] = string.char(101),\n\t[string.char(58)] = string.char(102),\n\t[string.char(59)] = string.char(103),\n\t[string.char(60)] = string.char(96),\n\t[string.char(61)] = string.char(97),\n\t[string.char(62)] = string.char(98),\n\t[string.char(63)] = string.char(99),\n\t[string.char(64)] = string.char(28),\n\t[string.char(65)] = string.char(29),\n\t[string.char(66)] = string.char(30),\n\t[string.char(67)] = string.char(31),\n\t[string.char(68)] = string.char(24),\n\t[string.char(69)] = string.char(25),\n\t[string.char(70)] = string.char(26),\n\t[string.char(71)] = string.char(27),\n\t[string.char(72)] = string.char(20),\n\t[string.char(73)] = string.char(21),\n\t[string.char(74)] = string.char(22),\n\t[string.char(75)] = string.char(23),\n\t[string.char(76)] = string.char(16),\n\t[string.char(77)] = string.char(17),\n\t[string.char(78)] = string.char(18),\n\t[string.char(79)] = string.char(19),\n\t[string.char(80)] = string.char(12),\n\t[string.char(81)] = string.char(13),\n\t[string.char(82)] = string.char(14),\n\t[string.char(83)] = string.char(15),\n\t[string.char(84)] = string.char(8),\n\t[string.char(85)] = string.char(9),\n\t[string.char(86)] = string.char(10),\n\t[string.char(87)] = string.char(11),\n\t[string.char(88)] = string.char(4),\n\t[string.char(89)] = string.char(5),\n\t[string.char(90)] = string.char(6),\n\t[string.char(91)] = string.char(7),\n\t[string.char(92)] = string.char(0),\n\t[string.char(93)] = string.char(1),\n\t[string.char(94)] = string.char(2),\n\t[string.char(95)] = string.char(3),\n\t[string.char(96)] = string.char(60),\n\t[string.char(97)] = string.char(61),\n\t[string.char(98)] = string.char(62),\n\t[string.char(99)] = string.char(63),\n\t[string.char(100)] = string.char(56),\n\t[string.char(101)] = string.char(57),\n\t[string.char(102)] = string.char(58),\n\t[string.char(103)] = string.char(59),\n\t[string.char(104)] = string.char(52),\n\t[string.char(105)] = string.char(53),\n\t[string.char(106)] = string.char(54),\n\t[string.char(107)] = string.char(55),\n\t[string.char(108)] = string.char(48),\n\t[string.char(109)] = string.char(49),\n\t[string.char(110)] = string.char(50),\n\t[string.char(111)] = string.char(51),\n\t[string.char(112)] = string.char(44),\n\t[string.char(113)] = string.char(45),\n\t[string.char(114)] = string.char(46),\n\t[string.char(115)] = string.char(47),\n\t[string.char(116)] = string.char(40),\n\t[string.char(117)] = string.char(41),\n\t[string.char(118)] = string.char(42),\n\t[string.char(119)] = string.char(43),\n\t[string.char(120)] = string.char(36),\n\t[string.char(121)] = string.char(37),\n\t[string.char(122)] = string.char(38),\n\t[string.char(123)] = string.char(39),\n\t[string.char(124)] = string.char(32),\n\t[string.char(125)] = string.char(33),\n\t[string.char(126)] = string.char(34),\n\t[string.char(127)] = string.char(35),\n\t[string.char(128)] = string.char(220),\n\t[string.char(129)] = string.char(221),\n\t[string.char(130)] = string.char(222),\n\t[string.char(131)] = string.char(223),\n\t[string.char(132)] = string.char(216),\n\t[string.char(133)] = string.char(217),\n\t[string.char(134)] = string.char(218),\n\t[string.char(135)] = string.char(219),\n\t[string.char(136)] = string.char(212),\n\t[string.char(137)] = string.char(213),\n\t[string.char(138)] = string.char(214),\n\t[string.char(139)] = string.char(215),\n\t[string.char(140)] = string.char(208),\n\t[string.char(141)] = string.char(209),\n\t[string.char(142)] = string.char(210),\n\t[string.char(143)] = string.char(211),\n\t[string.char(144)] = string.char(204),\n\t[string.char(145)] = string.char(205),\n\t[string.char(146)] = string.char(206),\n\t[string.char(147)] = string.char(207),\n\t[string.char(148)] = string.char(200),\n\t[string.char(149)] = string.char(201),\n\t[string.char(150)] = string.char(202),\n\t[string.char(151)] = string.char(203),\n\t[string.char(152)] = string.char(196),\n\t[string.char(153)] = string.char(197),\n\t[string.char(154)] = string.char(198),\n\t[string.char(155)] = string.char(199),\n\t[string.char(156)] = string.char(192),\n\t[string.char(157)] = string.char(193),\n\t[string.char(158)] = string.char(194),\n\t[string.char(159)] = string.char(195),\n\t[string.char(160)] = string.char(252),\n\t[string.char(161)] = string.char(253),\n\t[string.char(162)] = string.char(254),\n\t[string.char(163)] = string.char(255),\n\t[string.char(164)] = string.char(248),\n\t[string.char(165)] = string.char(249),\n\t[string.char(166)] = string.char(250),\n\t[string.char(167)] = string.char(251),\n\t[string.char(168)] = string.char(244),\n\t[string.char(169)] = string.char(245),\n\t[string.char(170)] = string.char(246),\n\t[string.char(171)] = string.char(247),\n\t[string.char(172)] = string.char(240),\n\t[string.char(173)] = string.char(241),\n\t[string.char(174)] = string.char(242),\n\t[string.char(175)] = string.char(243),\n\t[string.char(176)] = string.char(236),\n\t[string.char(177)] = string.char(237),\n\t[string.char(178)] = string.char(238),\n\t[string.char(179)] = string.char(239),\n\t[string.char(180)] = string.char(232),\n\t[string.char(181)] = string.char(233),\n\t[string.char(182)] = string.char(234),\n\t[string.char(183)] = string.char(235),\n\t[string.char(184)] = string.char(228),\n\t[string.char(185)] = string.char(229),\n\t[string.char(186)] = string.char(230),\n\t[string.char(187)] = string.char(231),\n\t[string.char(188)] = string.char(224),\n\t[string.char(189)] = string.char(225),\n\t[string.char(190)] = string.char(226),\n\t[string.char(191)] = string.char(227),\n\t[string.char(192)] = string.char(156),\n\t[string.char(193)] = string.char(157),\n\t[string.char(194)] = string.char(158),\n\t[string.char(195)] = string.char(159),\n\t[string.char(196)] = string.char(152),\n\t[string.char(197)] = string.char(153),\n\t[string.char(198)] = string.char(154),\n\t[string.char(199)] = string.char(155),\n\t[string.char(200)] = string.char(148),\n\t[string.char(201)] = string.char(149),\n\t[string.char(202)] = string.char(150),\n\t[string.char(203)] = string.char(151),\n\t[string.char(204)] = string.char(144),\n\t[string.char(205)] = string.char(145),\n\t[string.char(206)] = string.char(146),\n\t[string.char(207)] = string.char(147),\n\t[string.char(208)] = string.char(140),\n\t[string.char(209)] = string.char(141),\n\t[string.char(210)] = string.char(142),\n\t[string.char(211)] = string.char(143),\n\t[string.char(212)] = string.char(136),\n\t[string.char(213)] = string.char(137),\n\t[string.char(214)] = string.char(138),\n\t[string.char(215)] = string.char(139),\n\t[string.char(216)] = string.char(132),\n\t[string.char(217)] = string.char(133),\n\t[string.char(218)] = string.char(134),\n\t[string.char(219)] = string.char(135),\n\t[string.char(220)] = string.char(128),\n\t[string.char(221)] = string.char(129),\n\t[string.char(222)] = string.char(130),\n\t[string.char(223)] = string.char(131),\n\t[string.char(224)] = string.char(188),\n\t[string.char(225)] = string.char(189),\n\t[string.char(226)] = string.char(190),\n\t[string.char(227)] = string.char(191),\n\t[string.char(228)] = string.char(184),\n\t[string.char(229)] = string.char(185),\n\t[string.char(230)] = string.char(186),\n\t[string.char(231)] = string.char(187),\n\t[string.char(232)] = string.char(180),\n\t[string.char(233)] = string.char(181),\n\t[string.char(234)] = string.char(182),\n\t[string.char(235)] = string.char(183),\n\t[string.char(236)] = string.char(176),\n\t[string.char(237)] = string.char(177),\n\t[string.char(238)] = string.char(178),\n\t[string.char(239)] = string.char(179),\n\t[string.char(240)] = string.char(172),\n\t[string.char(241)] = string.char(173),\n\t[string.char(242)] = string.char(174),\n\t[string.char(243)] = string.char(175),\n\t[string.char(244)] = string.char(168),\n\t[string.char(245)] = string.char(169),\n\t[string.char(246)] = string.char(170),\n\t[string.char(247)] = string.char(171),\n\t[string.char(248)] = string.char(164),\n\t[string.char(249)] = string.char(165),\n\t[string.char(250)] = string.char(166),\n\t[string.char(251)] = string.char(167),\n\t[string.char(252)] = string.char(160),\n\t[string.char(253)] = string.char(161),\n\t[string.char(254)] = string.char(162),\n\t[string.char(255)] = string.char(163),\n}\n\nlocal xor_with_0x36 = {\n\t[string.char(0)] = string.char(54),\n\t[string.char(1)] = string.char(55),\n\t[string.char(2)] = string.char(52),\n\t[string.char(3)] = string.char(53),\n\t[string.char(4)] = string.char(50),\n\t[string.char(5)] = string.char(51),\n\t[string.char(6)] = string.char(48),\n\t[string.char(7)] = string.char(49),\n\t[string.char(8)] = string.char(62),\n\t[string.char(9)] = string.char(63),\n\t[string.char(10)] = string.char(60),\n\t[string.char(11)] = string.char(61),\n\t[string.char(12)] = string.char(58),\n\t[string.char(13)] = string.char(59),\n\t[string.char(14)] = string.char(56),\n\t[string.char(15)] = string.char(57),\n\t[string.char(16)] = string.char(38),\n\t[string.char(17)] = string.char(39),\n\t[string.char(18)] = string.char(36),\n\t[string.char(19)] = string.char(37),\n\t[string.char(20)] = string.char(34),\n\t[string.char(21)] = string.char(35),\n\t[string.char(22)] = string.char(32),\n\t[string.char(23)] = string.char(33),\n\t[string.char(24)] = string.char(46),\n\t[string.char(25)] = string.char(47),\n\t[string.char(26)] = string.char(44),\n\t[string.char(27)] = string.char(45),\n\t[string.char(28)] = string.char(42),\n\t[string.char(29)] = string.char(43),\n\t[string.char(30)] = string.char(40),\n\t[string.char(31)] = string.char(41),\n\t[string.char(32)] = string.char(22),\n\t[string.char(33)] = string.char(23),\n\t[string.char(34)] = string.char(20),\n\t[string.char(35)] = string.char(21),\n\t[string.char(36)] = string.char(18),\n\t[string.char(37)] = string.char(19),\n\t[string.char(38)] = string.char(16),\n\t[string.char(39)] = string.char(17),\n\t[string.char(40)] = string.char(30),\n\t[string.char(41)] = string.char(31),\n\t[string.char(42)] = string.char(28),\n\t[string.char(43)] = string.char(29),\n\t[string.char(44)] = string.char(26),\n\t[string.char(45)] = string.char(27),\n\t[string.char(46)] = string.char(24),\n\t[string.char(47)] = string.char(25),\n\t[string.char(48)] = string.char(6),\n\t[string.char(49)] = string.char(7),\n\t[string.char(50)] = string.char(4),\n\t[string.char(51)] = string.char(5),\n\t[string.char(52)] = string.char(2),\n\t[string.char(53)] = string.char(3),\n\t[string.char(54)] = string.char(0),\n\t[string.char(55)] = string.char(1),\n\t[string.char(56)] = string.char(14),\n\t[string.char(57)] = string.char(15),\n\t[string.char(58)] = string.char(12),\n\t[string.char(59)] = string.char(13),\n\t[string.char(60)] = string.char(10),\n\t[string.char(61)] = string.char(11),\n\t[string.char(62)] = string.char(8),\n\t[string.char(63)] = string.char(9),\n\t[string.char(64)] = string.char(118),\n\t[string.char(65)] = string.char(119),\n\t[string.char(66)] = string.char(116),\n\t[string.char(67)] = string.char(117),\n\t[string.char(68)] = string.char(114),\n\t[string.char(69)] = string.char(115),\n\t[string.char(70)] = string.char(112),\n\t[string.char(71)] = string.char(113),\n\t[string.char(72)] = string.char(126),\n\t[string.char(73)] = string.char(127),\n\t[string.char(74)] = string.char(124),\n\t[string.char(75)] = string.char(125),\n\t[string.char(76)] = string.char(122),\n\t[string.char(77)] = string.char(123),\n\t[string.char(78)] = string.char(120),\n\t[string.char(79)] = string.char(121),\n\t[string.char(80)] = string.char(102),\n\t[string.char(81)] = string.char(103),\n\t[string.char(82)] = string.char(100),\n\t[string.char(83)] = string.char(101),\n\t[string.char(84)] = string.char(98),\n\t[string.char(85)] = string.char(99),\n\t[string.char(86)] = string.char(96),\n\t[string.char(87)] = string.char(97),\n\t[string.char(88)] = string.char(110),\n\t[string.char(89)] = string.char(111),\n\t[string.char(90)] = string.char(108),\n\t[string.char(91)] = string.char(109),\n\t[string.char(92)] = string.char(106),\n\t[string.char(93)] = string.char(107),\n\t[string.char(94)] = string.char(104),\n\t[string.char(95)] = string.char(105),\n\t[string.char(96)] = string.char(86),\n\t[string.char(97)] = string.char(87),\n\t[string.char(98)] = string.char(84),\n\t[string.char(99)] = string.char(85),\n\t[string.char(100)] = string.char(82),\n\t[string.char(101)] = string.char(83),\n\t[string.char(102)] = string.char(80),\n\t[string.char(103)] = string.char(81),\n\t[string.char(104)] = string.char(94),\n\t[string.char(105)] = string.char(95),\n\t[string.char(106)] = string.char(92),\n\t[string.char(107)] = string.char(93),\n\t[string.char(108)] = string.char(90),\n\t[string.char(109)] = string.char(91),\n\t[string.char(110)] = string.char(88),\n\t[string.char(111)] = string.char(89),\n\t[string.char(112)] = string.char(70),\n\t[string.char(113)] = string.char(71),\n\t[string.char(114)] = string.char(68),\n\t[string.char(115)] = string.char(69),\n\t[string.char(116)] = string.char(66),\n\t[string.char(117)] = string.char(67),\n\t[string.char(118)] = string.char(64),\n\t[string.char(119)] = string.char(65),\n\t[string.char(120)] = string.char(78),\n\t[string.char(121)] = string.char(79),\n\t[string.char(122)] = string.char(76),\n\t[string.char(123)] = string.char(77),\n\t[string.char(124)] = string.char(74),\n\t[string.char(125)] = string.char(75),\n\t[string.char(126)] = string.char(72),\n\t[string.char(127)] = string.char(73),\n\t[string.char(128)] = string.char(182),\n\t[string.char(129)] = string.char(183),\n\t[string.char(130)] = string.char(180),\n\t[string.char(131)] = string.char(181),\n\t[string.char(132)] = string.char(178),\n\t[string.char(133)] = string.char(179),\n\t[string.char(134)] = string.char(176),\n\t[string.char(135)] = string.char(177),\n\t[string.char(136)] = string.char(190),\n\t[string.char(137)] = string.char(191),\n\t[string.char(138)] = string.char(188),\n\t[string.char(139)] = string.char(189),\n\t[string.char(140)] = string.char(186),\n\t[string.char(141)] = string.char(187),\n\t[string.char(142)] = string.char(184),\n\t[string.char(143)] = string.char(185),\n\t[string.char(144)] = string.char(166),\n\t[string.char(145)] = string.char(167),\n\t[string.char(146)] = string.char(164),\n\t[string.char(147)] = string.char(165),\n\t[string.char(148)] = string.char(162),\n\t[string.char(149)] = string.char(163),\n\t[string.char(150)] = string.char(160),\n\t[string.char(151)] = string.char(161),\n\t[string.char(152)] = string.char(174),\n\t[string.char(153)] = string.char(175),\n\t[string.char(154)] = string.char(172),\n\t[string.char(155)] = string.char(173),\n\t[string.char(156)] = string.char(170),\n\t[string.char(157)] = string.char(171),\n\t[string.char(158)] = string.char(168),\n\t[string.char(159)] = string.char(169),\n\t[string.char(160)] = string.char(150),\n\t[string.char(161)] = string.char(151),\n\t[string.char(162)] = string.char(148),\n\t[string.char(163)] = string.char(149),\n\t[string.char(164)] = string.char(146),\n\t[string.char(165)] = string.char(147),\n\t[string.char(166)] = string.char(144),\n\t[string.char(167)] = string.char(145),\n\t[string.char(168)] = string.char(158),\n\t[string.char(169)] = string.char(159),\n\t[string.char(170)] = string.char(156),\n\t[string.char(171)] = string.char(157),\n\t[string.char(172)] = string.char(154),\n\t[string.char(173)] = string.char(155),\n\t[string.char(174)] = string.char(152),\n\t[string.char(175)] = string.char(153),\n\t[string.char(176)] = string.char(134),\n\t[string.char(177)] = string.char(135),\n\t[string.char(178)] = string.char(132),\n\t[string.char(179)] = string.char(133),\n\t[string.char(180)] = string.char(130),\n\t[string.char(181)] = string.char(131),\n\t[string.char(182)] = string.char(128),\n\t[string.char(183)] = string.char(129),\n\t[string.char(184)] = string.char(142),\n\t[string.char(185)] = string.char(143),\n\t[string.char(186)] = string.char(140),\n\t[string.char(187)] = string.char(141),\n\t[string.char(188)] = string.char(138),\n\t[string.char(189)] = string.char(139),\n\t[string.char(190)] = string.char(136),\n\t[string.char(191)] = string.char(137),\n\t[string.char(192)] = string.char(246),\n\t[string.char(193)] = string.char(247),\n\t[string.char(194)] = string.char(244),\n\t[string.char(195)] = string.char(245),\n\t[string.char(196)] = string.char(242),\n\t[string.char(197)] = string.char(243),\n\t[string.char(198)] = string.char(240),\n\t[string.char(199)] = string.char(241),\n\t[string.char(200)] = string.char(254),\n\t[string.char(201)] = string.char(255),\n\t[string.char(202)] = string.char(252),\n\t[string.char(203)] = string.char(253),\n\t[string.char(204)] = string.char(250),\n\t[string.char(205)] = string.char(251),\n\t[string.char(206)] = string.char(248),\n\t[string.char(207)] = string.char(249),\n\t[string.char(208)] = string.char(230),\n\t[string.char(209)] = string.char(231),\n\t[string.char(210)] = string.char(228),\n\t[string.char(211)] = string.char(229),\n\t[string.char(212)] = string.char(226),\n\t[string.char(213)] = string.char(227),\n\t[string.char(214)] = string.char(224),\n\t[string.char(215)] = string.char(225),\n\t[string.char(216)] = string.char(238),\n\t[string.char(217)] = string.char(239),\n\t[string.char(218)] = string.char(236),\n\t[string.char(219)] = string.char(237),\n\t[string.char(220)] = string.char(234),\n\t[string.char(221)] = string.char(235),\n\t[string.char(222)] = string.char(232),\n\t[string.char(223)] = string.char(233),\n\t[string.char(224)] = string.char(214),\n\t[string.char(225)] = string.char(215),\n\t[string.char(226)] = string.char(212),\n\t[string.char(227)] = string.char(213),\n\t[string.char(228)] = string.char(210),\n\t[string.char(229)] = string.char(211),\n\t[string.char(230)] = string.char(208),\n\t[string.char(231)] = string.char(209),\n\t[string.char(232)] = string.char(222),\n\t[string.char(233)] = string.char(223),\n\t[string.char(234)] = string.char(220),\n\t[string.char(235)] = string.char(221),\n\t[string.char(236)] = string.char(218),\n\t[string.char(237)] = string.char(219),\n\t[string.char(238)] = string.char(216),\n\t[string.char(239)] = string.char(217),\n\t[string.char(240)] = string.char(198),\n\t[string.char(241)] = string.char(199),\n\t[string.char(242)] = string.char(196),\n\t[string.char(243)] = string.char(197),\n\t[string.char(244)] = string.char(194),\n\t[string.char(245)] = string.char(195),\n\t[string.char(246)] = string.char(192),\n\t[string.char(247)] = string.char(193),\n\t[string.char(248)] = string.char(206),\n\t[string.char(249)] = string.char(207),\n\t[string.char(250)] = string.char(204),\n\t[string.char(251)] = string.char(205),\n\t[string.char(252)] = string.char(202),\n\t[string.char(253)] = string.char(203),\n\t[string.char(254)] = string.char(200),\n\t[string.char(255)] = string.char(201),\n}\n\n-------------------------------------------------------------------------\n\nfunction sha256.sha256(msg)\n\tmsg = preproc(msg, #msg)\n\tlocal H = initH256( { })\n\tfor i = 1, #msg, 64 do digestblock(msg, i, H) end\n\treturn str2hexa(num2s(H[1], 4) .. num2s(H[2], 4) .. num2s(H[3], 4) .. num2s(H[4], 4) ..\n\tnum2s(H[5], 4) .. num2s(H[6], 4) .. num2s(H[7], 4) .. num2s(H[8], 4))\nend\n\nfunction sha256.sha256_binary(msg)\n\treturn hex_to_binary(sha256.sha256(msg))\nend\n\nfunction sha256.hmac_sha256(key, text)\n\tassert(type(key) == 'string', \"key passed to hmac_sha256 should be a string\")\n\tassert(type(text) == 'string', \"text passed to hmac_sha256 should be a string\")\n\n\tif #key > blocksize then\n\t\tkey = sha256.sha256_binary(key)\n\tend\n\n\tlocal key_xord_with_0x36 = key:gsub('.', xor_with_0x36) .. string.rep(string.char(0x36), blocksize - #key)\n\tlocal key_xord_with_0x5c = key:gsub('.', xor_with_0x5c) .. string.rep(string.char(0x5c), blocksize - #key)\n\n\treturn sha256.sha256(key_xord_with_0x5c .. sha256.sha256_binary(key_xord_with_0x36 .. text))\nend\n\n\nlocal index_table = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\n\nfunction to_binary(integer)\n    local remaining = tonumber(integer)\n    local bin_bits = ''\n\n    for i = 7, 0, -1 do\n        local current_power = math.pow(2, i)\n\n        if remaining >= current_power then\n            bin_bits = bin_bits .. '1'\n            remaining = remaining - current_power\n        else\n            bin_bits = bin_bits .. '0'\n        end\n    end\n\n    return bin_bits\nend\n\n\nfunction from_binary(bin_bits)\n    return tonumber(bin_bits, 2)\nend\n\n\nfunction to_base64(to_encode)\n    local bit_pattern = ''\n    local encoded = ''\n    local trailing = ''\n\n    for i = 1, string.len(to_encode) do\n        bit_pattern = bit_pattern .. to_binary(string.byte(string.sub(to_encode, i, i)))\n    end\n\n    -- Check the number of bytes. If it's not evenly divisible by three,\n    -- zero-pad the ending & append on the correct number of ``=``s.\n    if string.len(bit_pattern) % 3 == 2 then\n        trailing = '=='\n        bit_pattern = bit_pattern .. '0000000000000000'\n    elseif string.len(bit_pattern) % 3 == 1 then\n        trailing = '='\n        bit_pattern = bit_pattern .. '00000000'\n    end\n\n    for i = 1, string.len(bit_pattern), 6 do\n        local byte = string.sub(bit_pattern, i, i+5)\n        local offset = tonumber(from_binary(byte))\n        encoded = encoded .. string.sub(index_table, offset+1, offset+1)\n    end\n\n    return string.sub(encoded, 1, -1 - string.len(trailing)) .. trailing\nend\n\nfunction check_status() \n  ts = \"\"..os.time()\n\n  fibaro:debug(\"time: \"..ts)\n\n\n  hmac = sha256.hmac_sha256(code, ts)\n  local b64_hmac = urlencode(to_base64(hex_to_binary(hmac)))\n  fibaro:debug(b64_hmac)\n  local params = \"identifier=\" .. identifier .. \"&hash=\" .. b64_hmac .. \"&ts=\" .. ts\n  --fibaro:debug(\"params: \" .. params)\n  -- http://<ip>/open\n  \n  \n  IPgw = fibaro:get(fibaro:getSelfId(), \"IPAddress\")\n  fibaro:debug(\"IP: \"..IPgw)\n  local gw2 = Net.FHttp(IPgw, 80)\n  res_status = gw2:POST(\"/locker_status\", params ) ;\n  --res = gw:GET(\"/status\") ;\n  --fibaro:call(fibaro:getSelfId(), \"setProperty\", \"ui.LabelStatus.value\", \"checking\");\n  fibaro:debug(\"res: \"..res_status)\n  result_status = json.decode(res_status);\n  res_code = result_status.code\n  fibaro:debug(\"result: \" .. res_code)\n  if(res_code == 49) then\n    status = \"Porte fermée\"\n    fibaro:debug(\"Set icon \"..lockercloseid)\n    fibaro:call(fibaro:getSelfId(), \"setProperty\", \"currentIcon\", lockercloseid)\n  else\n    status = \"Porte ouverte\"\n    fibaro:debug(\"Set icon \"..lockeropenid)\n    fibaro:call(fibaro:getSelfId(), \"setProperty\", \"currentIcon\", lockeropenid)\n  end\n  fibaro:call(fibaro:getSelfId(), \"setProperty\", \"ui.LabelStatus.value\", status)\nend\n\n\n\nlastlog = fibaro:getGlobal('lastlog')\nwhile (true) do \n  if lastlog == nil then\n    lastlog = -1\n  end\n  \n  IP = fibaro:get(fibaro:getSelfId(), \"IPAddress\")\n  fibaro:debug(\"IP: \"..IP)\n  local gw = Net.FHttp(IP, 80)\n  res = gw:GET(\"/lockers\" ) ;\n  result = json.decode(res);\n  --search the device\n  for i = 1, #result.devices do   \n    device = result.devices[i]\n    if device.identifier == tonumber(identifier) then\n      fibaro:debug(\"Found the device\")\n      fibaro:debug(\"result last log: \"..device.last_log .. \". Last log: \"..lastlog)\n      if device.last_log ~= lastlog then\n        fibaro:debug(\"New log available: \" .. device.last_log)\n        fibaro:setGlobal('lastlog', device.last_log)\n        lastlog = device.last_log\n        --fibaro:call(fibaro:getSelfId(), \"pressButton\", \"4\")\n        check_status()\n      else\n        fibaro:debug(\"Last log unchanged: \"..lastlog)\n      end\n    else\n      fibaro:debug(\"Not the device: \"..device.identifier)\n    end\n    fibaro:sleep(1000)\n  end\nend","ui.LabelStatus.value":"Porte ouverte","visible":"true","rows":[{"type":"button","elements":[{"id":1,"lua":true,"waitForResponse":false,"caption":"Fermer","name":"ButtonClose","empty":false,"msg":"identifier = fibaro:getGlobalValue('lockeridentifier'..fibaro:getSelfId());\ncode = fibaro:getGlobalValue('locker_code'..fibaro:getSelfId());\nts = \"\"..os.time()\n\nfibaro:debug(\"time: \"..ts)\n\nlocal sha256 = { }\n\nlocal MOD = 2 ^ 32\nlocal MODM = MOD - 1\n \n \nfunction floor(n) \n  return n - (n % 1)\nend\n\nfunction bxor1 (a,b)\n  local r = 0\n  for i = 0, 31 do\n    local x = a / 2 + b / 2\n    if x ~= floor(x) then\n      r = r + 2^i\n    end\n    a = floor(a / 2)\n    b = floor(b / 2)\n  end\n  return r\nend \n \nlocal function bxor(a, b, c, ...)\n\tlocal z = nil\n\tif b then\n\t\ta = a % MOD\n\t\tb = b % MOD\n\t\tz = bxor1(a, b)\n\t\tif c then z = bxor(z, c, ...) end\n\t\treturn z\n\telseif a then\n\t\treturn a % MOD\n\telse\n\t\treturn 0\n\tend\nend\n \nlocal function band(a, b, c, ...)\n\tlocal z\n\tif b then\n\t\ta = a % MOD\n\t\tb = b % MOD\n\t\tz =((a + b) - bxor1(a, b)) / 2\n\t\tif c then z = bit32_band(z, c, ...) end\n\t\treturn z\n\telseif a then\n\t\treturn a % MOD\n\telse\n\t\treturn MODM\n\tend\nend\n \nlocal function bnot(x) return(-1 - x) % MOD end\n \nlocal function rshift1(a, disp)\n\tif disp < 0 then return lshift(a, - disp) end\n\treturn math.floor(a % 2 ^ 32 / 2 ^ disp)\nend\n \nlocal function rshift(x, disp)\n\tif disp > 31 or disp < -31 then return 0 end\n\treturn rshift1(x % MOD, disp)\nend\n \nlocal function lshift(a, disp)\n\tif disp < 0 then return rshift(a, - disp) end\n\treturn(a * 2 ^ disp) % 2 ^ 32\nend\n \nlocal function rrotate(x, disp)\n\tx = x % MOD\n\tdisp = disp % 32\n\tlocal low = band(x, 2 ^ disp - 1)\n\treturn rshift(x, disp) + lshift(low, 32 - disp)\nend\n \nlocal k = {\n\t0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,\n\t0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,\n\t0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,\n\t0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,\n\t0xe49b69c1,0xefbe4786,0x0fc19dc6,0x240ca1cc,\n\t0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,\n\t0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,\n\t0xc6e00bf3,0xd5a79147,0x06ca6351,0x14292967,\n\t0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,\n\t0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,\n\t0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,\n\t0xd192e819,0xd6990624,0xf40e3585,0x106aa070,\n\t0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,\n\t0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,\n\t0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,\n\t0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2,\n}\n \nlocal function str2hexa(s)\n\treturn(string.gsub(s, \".\", function(c) return string.format(\"%02x\", string.byte(c)) end))\nend\n \nlocal function num2s(l, n)\n\tlocal s = \"\"\n\tfor i = 1, n do\n\t\tlocal rem = l % 256\n\t\ts = string.char(rem) .. s\n\t\tl =(l - rem) / 256\n\tend\n\treturn s\nend\n \nlocal function s232num(s, i)\n\tlocal n = 0\n\tfor i = i, i + 3 do n = n * 256 + string.byte(s, i) end\n\treturn n\nend\n \nlocal function preproc(msg, len)\n\tlocal extra = 64 -((len + 9) % 64)\n\tlen = num2s(8 * len, 8)\n\tmsg = msg .. \"\\128\" .. string.rep(\"\\0\", extra) .. len\n\tassert(#msg % 64 == 0)\n\treturn msg\nend\n \nlocal function initH256(H)\n\tH[1] = 0x6a09e667\n\tH[2] = 0xbb67ae85\n\tH[3] = 0x3c6ef372\n\tH[4] = 0xa54ff53a\n\tH[5] = 0x510e527f\n\tH[6] = 0x9b05688c\n\tH[7] = 0x1f83d9ab\n\tH[8] = 0x5be0cd19\n\treturn H\nend\n \nlocal function digestblock(msg, i, H)\n\tlocal w = { }\n\tfor j = 1, 16 do w[j] = s232num(msg, i +(j - 1) * 4) end\n\tfor j = 17, 64 do\n\t\tlocal v = w[j - 15]\n\t\tlocal s0 = bxor(rrotate(v, 7), rrotate(v, 18), rshift(v, 3))\n\t\tv = w[j - 2]\n\t\tw[j] = w[j - 16] + s0 + w[j - 7] + bxor(rrotate(v, 17), rrotate(v, 19), rshift(v, 10))\n\tend\n\n\tlocal a, b, c, d, e, f, g, h = H[1], H[2], H[3], H[4], H[5], H[6], H[7], H[8]\n\tfor i = 1, 64 do\n\t\tlocal s0 = bxor(rrotate(a, 2), rrotate(a, 13), rrotate(a, 22))\n\t\tlocal maj = bxor(band(a, b), band(a, c), band(b, c))\n\t\tlocal t2 = s0 + maj\n\t\tlocal s1 = bxor(rrotate(e, 6), rrotate(e, 11), rrotate(e, 25))\n\t\tlocal ch = bxor(band(e, f), band(bnot(e), g))\n\t\tlocal t1 = h + s1 + ch + k[i] + w[i]\n\t\th, g, f, e, d, c, b, a = g, f, e, d + t1, c, b, a, t1 + t2\n\tend\n\n\tH[1] = band(H[1] + a)\n\tH[2] = band(H[2] + b)\n\tH[3] = band(H[3] + c)\n\tH[4] = band(H[4] + d)\n\tH[5] = band(H[5] + e)\n\tH[6] = band(H[6] + f)\n\tH[7] = band(H[7] + g)\n\tH[8] = band(H[8] + h)\nend\n\nlocal function hex_to_binary(hex)\n\treturn hex:gsub('..', function(hexval)\n\t\treturn string.char(tonumber(hexval, 16))\n\tend )\nend\n\nlocal blocksize = 64 -- 512 bits\n\nlocal xor_with_0x5c = {\n\t[string.char(0)] = string.char(92),\n\t[string.char(1)] = string.char(93),\n\t[string.char(2)] = string.char(94),\n\t[string.char(3)] = string.char(95),\n\t[string.char(4)] = string.char(88),\n\t[string.char(5)] = string.char(89),\n\t[string.char(6)] = string.char(90),\n\t[string.char(7)] = string.char(91),\n\t[string.char(8)] = string.char(84),\n\t[string.char(9)] = string.char(85),\n\t[string.char(10)] = string.char(86),\n\t[string.char(11)] = string.char(87),\n\t[string.char(12)] = string.char(80),\n\t[string.char(13)] = string.char(81),\n\t[string.char(14)] = string.char(82),\n\t[string.char(15)] = string.char(83),\n\t[string.char(16)] = string.char(76),\n\t[string.char(17)] = string.char(77),\n\t[string.char(18)] = string.char(78),\n\t[string.char(19)] = string.char(79),\n\t[string.char(20)] = string.char(72),\n\t[string.char(21)] = string.char(73),\n\t[string.char(22)] = string.char(74),\n\t[string.char(23)] = string.char(75),\n\t[string.char(24)] = string.char(68),\n\t[string.char(25)] = string.char(69),\n\t[string.char(26)] = string.char(70),\n\t[string.char(27)] = string.char(71),\n\t[string.char(28)] = string.char(64),\n\t[string.char(29)] = string.char(65),\n\t[string.char(30)] = string.char(66),\n\t[string.char(31)] = string.char(67),\n\t[string.char(32)] = string.char(124),\n\t[string.char(33)] = string.char(125),\n\t[string.char(34)] = string.char(126),\n\t[string.char(35)] = string.char(127),\n\t[string.char(36)] = string.char(120),\n\t[string.char(37)] = string.char(121),\n\t[string.char(38)] = string.char(122),\n\t[string.char(39)] = string.char(123),\n\t[string.char(40)] = string.char(116),\n\t[string.char(41)] = string.char(117),\n\t[string.char(42)] = string.char(118),\n\t[string.char(43)] = string.char(119),\n\t[string.char(44)] = string.char(112),\n\t[string.char(45)] = string.char(113),\n\t[string.char(46)] = string.char(114),\n\t[string.char(47)] = string.char(115),\n\t[string.char(48)] = string.char(108),\n\t[string.char(49)] = string.char(109),\n\t[string.char(50)] = string.char(110),\n\t[string.char(51)] = string.char(111),\n\t[string.char(52)] = string.char(104),\n\t[string.char(53)] = string.char(105),\n\t[string.char(54)] = string.char(106),\n\t[string.char(55)] = string.char(107),\n\t[string.char(56)] = string.char(100),\n\t[string.char(57)] = string.char(101),\n\t[string.char(58)] = string.char(102),\n\t[string.char(59)] = string.char(103),\n\t[string.char(60)] = string.char(96),\n\t[string.char(61)] = string.char(97),\n\t[string.char(62)] = string.char(98),\n\t[string.char(63)] = string.char(99),\n\t[string.char(64)] = string.char(28),\n\t[string.char(65)] = string.char(29),\n\t[string.char(66)] = string.char(30),\n\t[string.char(67)] = string.char(31),\n\t[string.char(68)] = string.char(24),\n\t[string.char(69)] = string.char(25),\n\t[string.char(70)] = string.char(26),\n\t[string.char(71)] = string.char(27),\n\t[string.char(72)] = string.char(20),\n\t[string.char(73)] = string.char(21),\n\t[string.char(74)] = string.char(22),\n\t[string.char(75)] = string.char(23),\n\t[string.char(76)] = string.char(16),\n\t[string.char(77)] = string.char(17),\n\t[string.char(78)] = string.char(18),\n\t[string.char(79)] = string.char(19),\n\t[string.char(80)] = string.char(12),\n\t[string.char(81)] = string.char(13),\n\t[string.char(82)] = string.char(14),\n\t[string.char(83)] = string.char(15),\n\t[string.char(84)] = string.char(8),\n\t[string.char(85)] = string.char(9),\n\t[string.char(86)] = string.char(10),\n\t[string.char(87)] = string.char(11),\n\t[string.char(88)] = string.char(4),\n\t[string.char(89)] = string.char(5),\n\t[string.char(90)] = string.char(6),\n\t[string.char(91)] = string.char(7),\n\t[string.char(92)] = string.char(0),\n\t[string.char(93)] = string.char(1),\n\t[string.char(94)] = string.char(2),\n\t[string.char(95)] = string.char(3),\n\t[string.char(96)] = string.char(60),\n\t[string.char(97)] = string.char(61),\n\t[string.char(98)] = string.char(62),\n\t[string.char(99)] = string.char(63),\n\t[string.char(100)] = string.char(56),\n\t[string.char(101)] = string.char(57),\n\t[string.char(102)] = string.char(58),\n\t[string.char(103)] = string.char(59),\n\t[string.char(104)] = string.char(52),\n\t[string.char(105)] = string.char(53),\n\t[string.char(106)] = string.char(54),\n\t[string.char(107)] = string.char(55),\n\t[string.char(108)] = string.char(48),\n\t[string.char(109)] = string.char(49),\n\t[string.char(110)] = string.char(50),\n\t[string.char(111)] = string.char(51),\n\t[string.char(112)] = string.char(44),\n\t[string.char(113)] = string.char(45),\n\t[string.char(114)] = string.char(46),\n\t[string.char(115)] = string.char(47),\n\t[string.char(116)] = string.char(40),\n\t[string.char(117)] = string.char(41),\n\t[string.char(118)] = string.char(42),\n\t[string.char(119)] = string.char(43),\n\t[string.char(120)] = string.char(36),\n\t[string.char(121)] = string.char(37),\n\t[string.char(122)] = string.char(38),\n\t[string.char(123)] = string.char(39),\n\t[string.char(124)] = string.char(32),\n\t[string.char(125)] = string.char(33),\n\t[string.char(126)] = string.char(34),\n\t[string.char(127)] = string.char(35),\n\t[string.char(128)] = string.char(220),\n\t[string.char(129)] = string.char(221),\n\t[string.char(130)] = string.char(222),\n\t[string.char(131)] = string.char(223),\n\t[string.char(132)] = string.char(216),\n\t[string.char(133)] = string.char(217),\n\t[string.char(134)] = string.char(218),\n\t[string.char(135)] = string.char(219),\n\t[string.char(136)] = string.char(212),\n\t[string.char(137)] = string.char(213),\n\t[string.char(138)] = string.char(214),\n\t[string.char(139)] = string.char(215),\n\t[string.char(140)] = string.char(208),\n\t[string.char(141)] = string.char(209),\n\t[string.char(142)] = string.char(210),\n\t[string.char(143)] = string.char(211),\n\t[string.char(144)] = string.char(204),\n\t[string.char(145)] = string.char(205),\n\t[string.char(146)] = string.char(206),\n\t[string.char(147)] = string.char(207),\n\t[string.char(148)] = string.char(200),\n\t[string.char(149)] = string.char(201),\n\t[string.char(150)] = string.char(202),\n\t[string.char(151)] = string.char(203),\n\t[string.char(152)] = string.char(196),\n\t[string.char(153)] = string.char(197),\n\t[string.char(154)] = string.char(198),\n\t[string.char(155)] = string.char(199),\n\t[string.char(156)] = string.char(192),\n\t[string.char(157)] = string.char(193),\n\t[string.char(158)] = string.char(194),\n\t[string.char(159)] = string.char(195),\n\t[string.char(160)] = string.char(252),\n\t[string.char(161)] = string.char(253),\n\t[string.char(162)] = string.char(254),\n\t[string.char(163)] = string.char(255),\n\t[string.char(164)] = string.char(248),\n\t[string.char(165)] = string.char(249),\n\t[string.char(166)] = string.char(250),\n\t[string.char(167)] = string.char(251),\n\t[string.char(168)] = string.char(244),\n\t[string.char(169)] = string.char(245),\n\t[string.char(170)] = string.char(246),\n\t[string.char(171)] = string.char(247),\n\t[string.char(172)] = string.char(240),\n\t[string.char(173)] = string.char(241),\n\t[string.char(174)] = string.char(242),\n\t[string.char(175)] = string.char(243),\n\t[string.char(176)] = string.char(236),\n\t[string.char(177)] = string.char(237),\n\t[string.char(178)] = string.char(238),\n\t[string.char(179)] = string.char(239),\n\t[string.char(180)] = string.char(232),\n\t[string.char(181)] = string.char(233),\n\t[string.char(182)] = string.char(234),\n\t[string.char(183)] = string.char(235),\n\t[string.char(184)] = string.char(228),\n\t[string.char(185)] = string.char(229),\n\t[string.char(186)] = string.char(230),\n\t[string.char(187)] = string.char(231),\n\t[string.char(188)] = string.char(224),\n\t[string.char(189)] = string.char(225),\n\t[string.char(190)] = string.char(226),\n\t[string.char(191)] = string.char(227),\n\t[string.char(192)] = string.char(156),\n\t[string.char(193)] = string.char(157),\n\t[string.char(194)] = string.char(158),\n\t[string.char(195)] = string.char(159),\n\t[string.char(196)] = string.char(152),\n\t[string.char(197)] = string.char(153),\n\t[string.char(198)] = string.char(154),\n\t[string.char(199)] = string.char(155),\n\t[string.char(200)] = string.char(148),\n\t[string.char(201)] = string.char(149),\n\t[string.char(202)] = string.char(150),\n\t[string.char(203)] = string.char(151),\n\t[string.char(204)] = string.char(144),\n\t[string.char(205)] = string.char(145),\n\t[string.char(206)] = string.char(146),\n\t[string.char(207)] = string.char(147),\n\t[string.char(208)] = string.char(140),\n\t[string.char(209)] = string.char(141),\n\t[string.char(210)] = string.char(142),\n\t[string.char(211)] = string.char(143),\n\t[string.char(212)] = string.char(136),\n\t[string.char(213)] = string.char(137),\n\t[string.char(214)] = string.char(138),\n\t[string.char(215)] = string.char(139),\n\t[string.char(216)] = string.char(132),\n\t[string.char(217)] = string.char(133),\n\t[string.char(218)] = string.char(134),\n\t[string.char(219)] = string.char(135),\n\t[string.char(220)] = string.char(128),\n\t[string.char(221)] = string.char(129),\n\t[string.char(222)] = string.char(130),\n\t[string.char(223)] = string.char(131),\n\t[string.char(224)] = string.char(188),\n\t[string.char(225)] = string.char(189),\n\t[string.char(226)] = string.char(190),\n\t[string.char(227)] = string.char(191),\n\t[string.char(228)] = string.char(184),\n\t[string.char(229)] = string.char(185),\n\t[string.char(230)] = string.char(186),\n\t[string.char(231)] = string.char(187),\n\t[string.char(232)] = string.char(180),\n\t[string.char(233)] = string.char(181),\n\t[string.char(234)] = string.char(182),\n\t[string.char(235)] = string.char(183),\n\t[string.char(236)] = string.char(176),\n\t[string.char(237)] = string.char(177),\n\t[string.char(238)] = string.char(178),\n\t[string.char(239)] = string.char(179),\n\t[string.char(240)] = string.char(172),\n\t[string.char(241)] = string.char(173),\n\t[string.char(242)] = string.char(174),\n\t[string.char(243)] = string.char(175),\n\t[string.char(244)] = string.char(168),\n\t[string.char(245)] = string.char(169),\n\t[string.char(246)] = string.char(170),\n\t[string.char(247)] = string.char(171),\n\t[string.char(248)] = string.char(164),\n\t[string.char(249)] = string.char(165),\n\t[string.char(250)] = string.char(166),\n\t[string.char(251)] = string.char(167),\n\t[string.char(252)] = string.char(160),\n\t[string.char(253)] = string.char(161),\n\t[string.char(254)] = string.char(162),\n\t[string.char(255)] = string.char(163),\n}\n\nlocal xor_with_0x36 = {\n\t[string.char(0)] = string.char(54),\n\t[string.char(1)] = string.char(55),\n\t[string.char(2)] = string.char(52),\n\t[string.char(3)] = string.char(53),\n\t[string.char(4)] = string.char(50),\n\t[string.char(5)] = string.char(51),\n\t[string.char(6)] = string.char(48),\n\t[string.char(7)] = string.char(49),\n\t[string.char(8)] = string.char(62),\n\t[string.char(9)] = string.char(63),\n\t[string.char(10)] = string.char(60),\n\t[string.char(11)] = string.char(61),\n\t[string.char(12)] = string.char(58),\n\t[string.char(13)] = string.char(59),\n\t[string.char(14)] = string.char(56),\n\t[string.char(15)] = string.char(57),\n\t[string.char(16)] = string.char(38),\n\t[string.char(17)] = string.char(39),\n\t[string.char(18)] = string.char(36),\n\t[string.char(19)] = string.char(37),\n\t[string.char(20)] = string.char(34),\n\t[string.char(21)] = string.char(35),\n\t[string.char(22)] = string.char(32),\n\t[string.char(23)] = string.char(33),\n\t[string.char(24)] = string.char(46),\n\t[string.char(25)] = string.char(47),\n\t[string.char(26)] = string.char(44),\n\t[string.char(27)] = string.char(45),\n\t[string.char(28)] = string.char(42),\n\t[string.char(29)] = string.char(43),\n\t[string.char(30)] = string.char(40),\n\t[string.char(31)] = string.char(41),\n\t[string.char(32)] = string.char(22),\n\t[string.char(33)] = string.char(23),\n\t[string.char(34)] = string.char(20),\n\t[string.char(35)] = string.char(21),\n\t[string.char(36)] = string.char(18),\n\t[string.char(37)] = string.char(19),\n\t[string.char(38)] = string.char(16),\n\t[string.char(39)] = string.char(17),\n\t[string.char(40)] = string.char(30),\n\t[string.char(41)] = string.char(31),\n\t[string.char(42)] = string.char(28),\n\t[string.char(43)] = string.char(29),\n\t[string.char(44)] = string.char(26),\n\t[string.char(45)] = string.char(27),\n\t[string.char(46)] = string.char(24),\n\t[string.char(47)] = string.char(25),\n\t[string.char(48)] = string.char(6),\n\t[string.char(49)] = string.char(7),\n\t[string.char(50)] = string.char(4),\n\t[string.char(51)] = string.char(5),\n\t[string.char(52)] = string.char(2),\n\t[string.char(53)] = string.char(3),\n\t[string.char(54)] = string.char(0),\n\t[string.char(55)] = string.char(1),\n\t[string.char(56)] = string.char(14),\n\t[string.char(57)] = string.char(15),\n\t[string.char(58)] = string.char(12),\n\t[string.char(59)] = string.char(13),\n\t[string.char(60)] = string.char(10),\n\t[string.char(61)] = string.char(11),\n\t[string.char(62)] = string.char(8),\n\t[string.char(63)] = string.char(9),\n\t[string.char(64)] = string.char(118),\n\t[string.char(65)] = string.char(119),\n\t[string.char(66)] = string.char(116),\n\t[string.char(67)] = string.char(117),\n\t[string.char(68)] = string.char(114),\n\t[string.char(69)] = string.char(115),\n\t[string.char(70)] = string.char(112),\n\t[string.char(71)] = string.char(113),\n\t[string.char(72)] = string.char(126),\n\t[string.char(73)] = string.char(127),\n\t[string.char(74)] = string.char(124),\n\t[string.char(75)] = string.char(125),\n\t[string.char(76)] = string.char(122),\n\t[string.char(77)] = string.char(123),\n\t[string.char(78)] = string.char(120),\n\t[string.char(79)] = string.char(121),\n\t[string.char(80)] = string.char(102),\n\t[string.char(81)] = string.char(103),\n\t[string.char(82)] = string.char(100),\n\t[string.char(83)] = string.char(101),\n\t[string.char(84)] = string.char(98),\n\t[string.char(85)] = string.char(99),\n\t[string.char(86)] = string.char(96),\n\t[string.char(87)] = string.char(97),\n\t[string.char(88)] = string.char(110),\n\t[string.char(89)] = string.char(111),\n\t[string.char(90)] = string.char(108),\n\t[string.char(91)] = string.char(109),\n\t[string.char(92)] = string.char(106),\n\t[string.char(93)] = string.char(107),\n\t[string.char(94)] = string.char(104),\n\t[string.char(95)] = string.char(105),\n\t[string.char(96)] = string.char(86),\n\t[string.char(97)] = string.char(87),\n\t[string.char(98)] = string.char(84),\n\t[string.char(99)] = string.char(85),\n\t[string.char(100)] = string.char(82),\n\t[string.char(101)] = string.char(83),\n\t[string.char(102)] = string.char(80),\n\t[string.char(103)] = string.char(81),\n\t[string.char(104)] = string.char(94),\n\t[string.char(105)] = string.char(95),\n\t[string.char(106)] = string.char(92),\n\t[string.char(107)] = string.char(93),\n\t[string.char(108)] = string.char(90),\n\t[string.char(109)] = string.char(91),\n\t[string.char(110)] = string.char(88),\n\t[string.char(111)] = string.char(89),\n\t[string.char(112)] = string.char(70),\n\t[string.char(113)] = string.char(71),\n\t[string.char(114)] = string.char(68),\n\t[string.char(115)] = string.char(69),\n\t[string.char(116)] = string.char(66),\n\t[string.char(117)] = string.char(67),\n\t[string.char(118)] = string.char(64),\n\t[string.char(119)] = string.char(65),\n\t[string.char(120)] = string.char(78),\n\t[string.char(121)] = string.char(79),\n\t[string.char(122)] = string.char(76),\n\t[string.char(123)] = string.char(77),\n\t[string.char(124)] = string.char(74),\n\t[string.char(125)] = string.char(75),\n\t[string.char(126)] = string.char(72),\n\t[string.char(127)] = string.char(73),\n\t[string.char(128)] = string.char(182),\n\t[string.char(129)] = string.char(183),\n\t[string.char(130)] = string.char(180),\n\t[string.char(131)] = string.char(181),\n\t[string.char(132)] = string.char(178),\n\t[string.char(133)] = string.char(179),\n\t[string.char(134)] = string.char(176),\n\t[string.char(135)] = string.char(177),\n\t[string.char(136)] = string.char(190),\n\t[string.char(137)] = string.char(191),\n\t[string.char(138)] = string.char(188),\n\t[string.char(139)] = string.char(189),\n\t[string.char(140)] = string.char(186),\n\t[string.char(141)] = string.char(187),\n\t[string.char(142)] = string.char(184),\n\t[string.char(143)] = string.char(185),\n\t[string.char(144)] = string.char(166),\n\t[string.char(145)] = string.char(167),\n\t[string.char(146)] = string.char(164),\n\t[string.char(147)] = string.char(165),\n\t[string.char(148)] = string.char(162),\n\t[string.char(149)] = string.char(163),\n\t[string.char(150)] = string.char(160),\n\t[string.char(151)] = string.char(161),\n\t[string.char(152)] = string.char(174),\n\t[string.char(153)] = string.char(175),\n\t[string.char(154)] = string.char(172),\n\t[string.char(155)] = string.char(173),\n\t[string.char(156)] = string.char(170),\n\t[string.char(157)] = string.char(171),\n\t[string.char(158)] = string.char(168),\n\t[string.char(159)] = string.char(169),\n\t[string.char(160)] = string.char(150),\n\t[string.char(161)] = string.char(151),\n\t[string.char(162)] = string.char(148),\n\t[string.char(163)] = string.char(149),\n\t[string.char(164)] = string.char(146),\n\t[string.char(165)] = string.char(147),\n\t[string.char(166)] = string.char(144),\n\t[string.char(167)] = string.char(145),\n\t[string.char(168)] = string.char(158),\n\t[string.char(169)] = string.char(159),\n\t[string.char(170)] = string.char(156),\n\t[string.char(171)] = string.char(157),\n\t[string.char(172)] = string.char(154),\n\t[string.char(173)] = string.char(155),\n\t[string.char(174)] = string.char(152),\n\t[string.char(175)] = string.char(153),\n\t[string.char(176)] = string.char(134),\n\t[string.char(177)] = string.char(135),\n\t[string.char(178)] = string.char(132),\n\t[string.char(179)] = string.char(133),\n\t[string.char(180)] = string.char(130),\n\t[string.char(181)] = string.char(131),\n\t[string.char(182)] = string.char(128),\n\t[string.char(183)] = string.char(129),\n\t[string.char(184)] = string.char(142),\n\t[string.char(185)] = string.char(143),\n\t[string.char(186)] = string.char(140),\n\t[string.char(187)] = string.char(141),\n\t[string.char(188)] = string.char(138),\n\t[string.char(189)] = string.char(139),\n\t[string.char(190)] = string.char(136),\n\t[string.char(191)] = string.char(137),\n\t[string.char(192)] = string.char(246),\n\t[string.char(193)] = string.char(247),\n\t[string.char(194)] = string.char(244),\n\t[string.char(195)] = string.char(245),\n\t[string.char(196)] = string.char(242),\n\t[string.char(197)] = string.char(243),\n\t[string.char(198)] = string.char(240),\n\t[string.char(199)] = string.char(241),\n\t[string.char(200)] = string.char(254),\n\t[string.char(201)] = string.char(255),\n\t[string.char(202)] = string.char(252),\n\t[string.char(203)] = string.char(253),\n\t[string.char(204)] = string.char(250),\n\t[string.char(205)] = string.char(251),\n\t[string.char(206)] = string.char(248),\n\t[string.char(207)] = string.char(249),\n\t[string.char(208)] = string.char(230),\n\t[string.char(209)] = string.char(231),\n\t[string.char(210)] = string.char(228),\n\t[string.char(211)] = string.char(229),\n\t[string.char(212)] = string.char(226),\n\t[string.char(213)] = string.char(227),\n\t[string.char(214)] = string.char(224),\n\t[string.char(215)] = string.char(225),\n\t[string.char(216)] = string.char(238),\n\t[string.char(217)] = string.char(239),\n\t[string.char(218)] = string.char(236),\n\t[string.char(219)] = string.char(237),\n\t[string.char(220)] = string.char(234),\n\t[string.char(221)] = string.char(235),\n\t[string.char(222)] = string.char(232),\n\t[string.char(223)] = string.char(233),\n\t[string.char(224)] = string.char(214),\n\t[string.char(225)] = string.char(215),\n\t[string.char(226)] = string.char(212),\n\t[string.char(227)] = string.char(213),\n\t[string.char(228)] = string.char(210),\n\t[string.char(229)] = string.char(211),\n\t[string.char(230)] = string.char(208),\n\t[string.char(231)] = string.char(209),\n\t[string.char(232)] = string.char(222),\n\t[string.char(233)] = string.char(223),\n\t[string.char(234)] = string.char(220),\n\t[string.char(235)] = string.char(221),\n\t[string.char(236)] = string.char(218),\n\t[string.char(237)] = string.char(219),\n\t[string.char(238)] = string.char(216),\n\t[string.char(239)] = string.char(217),\n\t[string.char(240)] = string.char(198),\n\t[string.char(241)] = string.char(199),\n\t[string.char(242)] = string.char(196),\n\t[string.char(243)] = string.char(197),\n\t[string.char(244)] = string.char(194),\n\t[string.char(245)] = string.char(195),\n\t[string.char(246)] = string.char(192),\n\t[string.char(247)] = string.char(193),\n\t[string.char(248)] = string.char(206),\n\t[string.char(249)] = string.char(207),\n\t[string.char(250)] = string.char(204),\n\t[string.char(251)] = string.char(205),\n\t[string.char(252)] = string.char(202),\n\t[string.char(253)] = string.char(203),\n\t[string.char(254)] = string.char(200),\n\t[string.char(255)] = string.char(201),\n}\n\n-------------------------------------------------------------------------\n\nfunction sha256.sha256(msg)\n\tmsg = preproc(msg, #msg)\n\tlocal H = initH256( { })\n\tfor i = 1, #msg, 64 do digestblock(msg, i, H) end\n\treturn str2hexa(num2s(H[1], 4) .. num2s(H[2], 4) .. num2s(H[3], 4) .. num2s(H[4], 4) ..\n\tnum2s(H[5], 4) .. num2s(H[6], 4) .. num2s(H[7], 4) .. num2s(H[8], 4))\nend\n\nfunction sha256.sha256_binary(msg)\n\treturn hex_to_binary(sha256.sha256(msg))\nend\n\nfunction sha256.hmac_sha256(key, text)\n\tassert(type(key) == 'string', \"key passed to hmac_sha256 should be a string\")\n\tassert(type(text) == 'string', \"text passed to hmac_sha256 should be a string\")\n\n\tif #key > blocksize then\n\t\tkey = sha256.sha256_binary(key)\n\tend\n\n\tlocal key_xord_with_0x36 = key:gsub('.', xor_with_0x36) .. string.rep(string.char(0x36), blocksize - #key)\n\tlocal key_xord_with_0x5c = key:gsub('.', xor_with_0x5c) .. string.rep(string.char(0x5c), blocksize - #key)\n\n\treturn sha256.sha256(key_xord_with_0x5c .. sha256.sha256_binary(key_xord_with_0x36 .. text))\nend\n\n\nlocal index_table = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\n\nfunction to_binary(integer)\n    local remaining = tonumber(integer)\n    local bin_bits = ''\n\n    for i = 7, 0, -1 do\n        local current_power = math.pow(2, i)\n\n        if remaining >= current_power then\n            bin_bits = bin_bits .. '1'\n            remaining = remaining - current_power\n        else\n            bin_bits = bin_bits .. '0'\n        end\n    end\n\n    return bin_bits\nend\n\n\nfunction from_binary(bin_bits)\n    return tonumber(bin_bits, 2)\nend\n\n\nfunction to_base64(to_encode)\n    local bit_pattern = ''\n    local encoded = ''\n    local trailing = ''\n\n    for i = 1, string.len(to_encode) do\n        bit_pattern = bit_pattern .. to_binary(string.byte(string.sub(to_encode, i, i)))\n    end\n\n    -- Check the number of bytes. If it's not evenly divisible by three,\n    -- zero-pad the ending & append on the correct number of ``=``s.\n    if string.len(bit_pattern) % 3 == 2 then\n        trailing = '=='\n        bit_pattern = bit_pattern .. '0000000000000000'\n    elseif string.len(bit_pattern) % 3 == 1 then\n        trailing = '='\n        bit_pattern = bit_pattern .. '00000000'\n    end\n\n    for i = 1, string.len(bit_pattern), 6 do\n        local byte = string.sub(bit_pattern, i, i+5)\n        local offset = tonumber(from_binary(byte))\n        encoded = encoded .. string.sub(index_table, offset+1, offset+1)\n    end\n\n    return string.sub(encoded, 1, -1 - string.len(trailing)) .. trailing\nend\n\n\n--function urlencode(u) \n--\treturn u --:gsub(\"=\", '%%%%3b')\n--end\n\nhmac = sha256.hmac_sha256(code, ts)\nlocal b64_hmac = urlencode(to_base64(hex_to_binary(hmac)))\nfibaro:debug(b64_hmac)\nlocal params = \"identifier=\" .. identifier .. \"&hash=\" .. b64_hmac .. \"&ts=\" .. ts\n--fibaro:debug(\"params: \" .. params)\n-- http://<ip>/open\n\n\nIP = fibaro:get(fibaro:getSelfId(), \"IPAddress\")\nfibaro:debug(\"IP: \"..IP)\nlocal gw = Net.FHttp(IP, 80)\nres = gw:POST(\"/close\", params ) ;\n--res = gw:GET(\"/status\") ;\n\nfibaro:debug(\"response: \"..res)\n","buttonIcon":1010,"favourite":false,"main":false},{"id":2,"lua":true,"waitForResponse":false,"caption":"Ouvrir","name":"ButtonOpen","empty":false,"msg":"identifier = fibaro:getGlobalValue('lockeridentifier'..fibaro:getSelfId());\ncode = fibaro:getGlobalValue('locker_code'..fibaro:getSelfId());\nts = \"\"..os.time()\n\nfibaro:debug(\"time: \"..ts)\n\nlocal sha256 = { }\n\nlocal MOD = 2 ^ 32\nlocal MODM = MOD - 1\n \n \nfunction floor(n) \n  return n - (n % 1)\nend\n\nfunction bxor1 (a,b)\n  local r = 0\n  for i = 0, 31 do\n    local x = a / 2 + b / 2\n    if x ~= floor(x) then\n      r = r + 2^i\n    end\n    a = floor(a / 2)\n    b = floor(b / 2)\n  end\n  return r\nend \n \nlocal function bxor(a, b, c, ...)\n\tlocal z = nil\n\tif b then\n\t\ta = a % MOD\n\t\tb = b % MOD\n\t\tz = bxor1(a, b)\n\t\tif c then z = bxor(z, c, ...) end\n\t\treturn z\n\telseif a then\n\t\treturn a % MOD\n\telse\n\t\treturn 0\n\tend\nend\n \nlocal function band(a, b, c, ...)\n\tlocal z\n\tif b then\n\t\ta = a % MOD\n\t\tb = b % MOD\n\t\tz =((a + b) - bxor1(a, b)) / 2\n\t\tif c then z = bit32_band(z, c, ...) end\n\t\treturn z\n\telseif a then\n\t\treturn a % MOD\n\telse\n\t\treturn MODM\n\tend\nend\n \nlocal function bnot(x) return(-1 - x) % MOD end\n \nlocal function rshift1(a, disp)\n\tif disp < 0 then return lshift(a, - disp) end\n\treturn math.floor(a % 2 ^ 32 / 2 ^ disp)\nend\n \nlocal function rshift(x, disp)\n\tif disp > 31 or disp < -31 then return 0 end\n\treturn rshift1(x % MOD, disp)\nend\n \nlocal function lshift(a, disp)\n\tif disp < 0 then return rshift(a, - disp) end\n\treturn(a * 2 ^ disp) % 2 ^ 32\nend\n \nlocal function rrotate(x, disp)\n\tx = x % MOD\n\tdisp = disp % 32\n\tlocal low = band(x, 2 ^ disp - 1)\n\treturn rshift(x, disp) + lshift(low, 32 - disp)\nend\n \nlocal k = {\n\t0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,\n\t0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,\n\t0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,\n\t0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,\n\t0xe49b69c1,0xefbe4786,0x0fc19dc6,0x240ca1cc,\n\t0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,\n\t0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,\n\t0xc6e00bf3,0xd5a79147,0x06ca6351,0x14292967,\n\t0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,\n\t0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,\n\t0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,\n\t0xd192e819,0xd6990624,0xf40e3585,0x106aa070,\n\t0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,\n\t0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,\n\t0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,\n\t0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2,\n}\n \nlocal function str2hexa(s)\n\treturn(string.gsub(s, \".\", function(c) return string.format(\"%02x\", string.byte(c)) end))\nend\n \nlocal function num2s(l, n)\n\tlocal s = \"\"\n\tfor i = 1, n do\n\t\tlocal rem = l % 256\n\t\ts = string.char(rem) .. s\n\t\tl =(l - rem) / 256\n\tend\n\treturn s\nend\n \nlocal function s232num(s, i)\n\tlocal n = 0\n\tfor i = i, i + 3 do n = n * 256 + string.byte(s, i) end\n\treturn n\nend\n \nlocal function preproc(msg, len)\n\tlocal extra = 64 -((len + 9) % 64)\n\tlen = num2s(8 * len, 8)\n\tmsg = msg .. \"\\128\" .. string.rep(\"\\0\", extra) .. len\n\tassert(#msg % 64 == 0)\n\treturn msg\nend\n \nlocal function initH256(H)\n\tH[1] = 0x6a09e667\n\tH[2] = 0xbb67ae85\n\tH[3] = 0x3c6ef372\n\tH[4] = 0xa54ff53a\n\tH[5] = 0x510e527f\n\tH[6] = 0x9b05688c\n\tH[7] = 0x1f83d9ab\n\tH[8] = 0x5be0cd19\n\treturn H\nend\n \nlocal function digestblock(msg, i, H)\n\tlocal w = { }\n\tfor j = 1, 16 do w[j] = s232num(msg, i +(j - 1) * 4) end\n\tfor j = 17, 64 do\n\t\tlocal v = w[j - 15]\n\t\tlocal s0 = bxor(rrotate(v, 7), rrotate(v, 18), rshift(v, 3))\n\t\tv = w[j - 2]\n\t\tw[j] = w[j - 16] + s0 + w[j - 7] + bxor(rrotate(v, 17), rrotate(v, 19), rshift(v, 10))\n\tend\n\n\tlocal a, b, c, d, e, f, g, h = H[1], H[2], H[3], H[4], H[5], H[6], H[7], H[8]\n\tfor i = 1, 64 do\n\t\tlocal s0 = bxor(rrotate(a, 2), rrotate(a, 13), rrotate(a, 22))\n\t\tlocal maj = bxor(band(a, b), band(a, c), band(b, c))\n\t\tlocal t2 = s0 + maj\n\t\tlocal s1 = bxor(rrotate(e, 6), rrotate(e, 11), rrotate(e, 25))\n\t\tlocal ch = bxor(band(e, f), band(bnot(e), g))\n\t\tlocal t1 = h + s1 + ch + k[i] + w[i]\n\t\th, g, f, e, d, c, b, a = g, f, e, d + t1, c, b, a, t1 + t2\n\tend\n\n\tH[1] = band(H[1] + a)\n\tH[2] = band(H[2] + b)\n\tH[3] = band(H[3] + c)\n\tH[4] = band(H[4] + d)\n\tH[5] = band(H[5] + e)\n\tH[6] = band(H[6] + f)\n\tH[7] = band(H[7] + g)\n\tH[8] = band(H[8] + h)\nend\n\nlocal function hex_to_binary(hex)\n\treturn hex:gsub('..', function(hexval)\n\t\treturn string.char(tonumber(hexval, 16))\n\tend )\nend\n\nlocal blocksize = 64 -- 512 bits\n\nlocal xor_with_0x5c = {\n\t[string.char(0)] = string.char(92),\n\t[string.char(1)] = string.char(93),\n\t[string.char(2)] = string.char(94),\n\t[string.char(3)] = string.char(95),\n\t[string.char(4)] = string.char(88),\n\t[string.char(5)] = string.char(89),\n\t[string.char(6)] = string.char(90),\n\t[string.char(7)] = string.char(91),\n\t[string.char(8)] = string.char(84),\n\t[string.char(9)] = string.char(85),\n\t[string.char(10)] = string.char(86),\n\t[string.char(11)] = string.char(87),\n\t[string.char(12)] = string.char(80),\n\t[string.char(13)] = string.char(81),\n\t[string.char(14)] = string.char(82),\n\t[string.char(15)] = string.char(83),\n\t[string.char(16)] = string.char(76),\n\t[string.char(17)] = string.char(77),\n\t[string.char(18)] = string.char(78),\n\t[string.char(19)] = string.char(79),\n\t[string.char(20)] = string.char(72),\n\t[string.char(21)] = string.char(73),\n\t[string.char(22)] = string.char(74),\n\t[string.char(23)] = string.char(75),\n\t[string.char(24)] = string.char(68),\n\t[string.char(25)] = string.char(69),\n\t[string.char(26)] = string.char(70),\n\t[string.char(27)] = string.char(71),\n\t[string.char(28)] = string.char(64),\n\t[string.char(29)] = string.char(65),\n\t[string.char(30)] = string.char(66),\n\t[string.char(31)] = string.char(67),\n\t[string.char(32)] = string.char(124),\n\t[string.char(33)] = string.char(125),\n\t[string.char(34)] = string.char(126),\n\t[string.char(35)] = string.char(127),\n\t[string.char(36)] = string.char(120),\n\t[string.char(37)] = string.char(121),\n\t[string.char(38)] = string.char(122),\n\t[string.char(39)] = string.char(123),\n\t[string.char(40)] = string.char(116),\n\t[string.char(41)] = string.char(117),\n\t[string.char(42)] = string.char(118),\n\t[string.char(43)] = string.char(119),\n\t[string.char(44)] = string.char(112),\n\t[string.char(45)] = string.char(113),\n\t[string.char(46)] = string.char(114),\n\t[string.char(47)] = string.char(115),\n\t[string.char(48)] = string.char(108),\n\t[string.char(49)] = string.char(109),\n\t[string.char(50)] = string.char(110),\n\t[string.char(51)] = string.char(111),\n\t[string.char(52)] = string.char(104),\n\t[string.char(53)] = string.char(105),\n\t[string.char(54)] = string.char(106),\n\t[string.char(55)] = string.char(107),\n\t[string.char(56)] = string.char(100),\n\t[string.char(57)] = string.char(101),\n\t[string.char(58)] = string.char(102),\n\t[string.char(59)] = string.char(103),\n\t[string.char(60)] = string.char(96),\n\t[string.char(61)] = string.char(97),\n\t[string.char(62)] = string.char(98),\n\t[string.char(63)] = string.char(99),\n\t[string.char(64)] = string.char(28),\n\t[string.char(65)] = string.char(29),\n\t[string.char(66)] = string.char(30),\n\t[string.char(67)] = string.char(31),\n\t[string.char(68)] = string.char(24),\n\t[string.char(69)] = string.char(25),\n\t[string.char(70)] = string.char(26),\n\t[string.char(71)] = string.char(27),\n\t[string.char(72)] = string.char(20),\n\t[string.char(73)] = string.char(21),\n\t[string.char(74)] = string.char(22),\n\t[string.char(75)] = string.char(23),\n\t[string.char(76)] = string.char(16),\n\t[string.char(77)] = string.char(17),\n\t[string.char(78)] = string.char(18),\n\t[string.char(79)] = string.char(19),\n\t[string.char(80)] = string.char(12),\n\t[string.char(81)] = string.char(13),\n\t[string.char(82)] = string.char(14),\n\t[string.char(83)] = string.char(15),\n\t[string.char(84)] = string.char(8),\n\t[string.char(85)] = string.char(9),\n\t[string.char(86)] = string.char(10),\n\t[string.char(87)] = string.char(11),\n\t[string.char(88)] = string.char(4),\n\t[string.char(89)] = string.char(5),\n\t[string.char(90)] = string.char(6),\n\t[string.char(91)] = string.char(7),\n\t[string.char(92)] = string.char(0),\n\t[string.char(93)] = string.char(1),\n\t[string.char(94)] = string.char(2),\n\t[string.char(95)] = string.char(3),\n\t[string.char(96)] = string.char(60),\n\t[string.char(97)] = string.char(61),\n\t[string.char(98)] = string.char(62),\n\t[string.char(99)] = string.char(63),\n\t[string.char(100)] = string.char(56),\n\t[string.char(101)] = string.char(57),\n\t[string.char(102)] = string.char(58),\n\t[string.char(103)] = string.char(59),\n\t[string.char(104)] = string.char(52),\n\t[string.char(105)] = string.char(53),\n\t[string.char(106)] = string.char(54),\n\t[string.char(107)] = string.char(55),\n\t[string.char(108)] = string.char(48),\n\t[string.char(109)] = string.char(49),\n\t[string.char(110)] = string.char(50),\n\t[string.char(111)] = string.char(51),\n\t[string.char(112)] = string.char(44),\n\t[string.char(113)] = string.char(45),\n\t[string.char(114)] = string.char(46),\n\t[string.char(115)] = string.char(47),\n\t[string.char(116)] = string.char(40),\n\t[string.char(117)] = string.char(41),\n\t[string.char(118)] = string.char(42),\n\t[string.char(119)] = string.char(43),\n\t[string.char(120)] = string.char(36),\n\t[string.char(121)] = string.char(37),\n\t[string.char(122)] = string.char(38),\n\t[string.char(123)] = string.char(39),\n\t[string.char(124)] = string.char(32),\n\t[string.char(125)] = string.char(33),\n\t[string.char(126)] = string.char(34),\n\t[string.char(127)] = string.char(35),\n\t[string.char(128)] = string.char(220),\n\t[string.char(129)] = string.char(221),\n\t[string.char(130)] = string.char(222),\n\t[string.char(131)] = string.char(223),\n\t[string.char(132)] = string.char(216),\n\t[string.char(133)] = string.char(217),\n\t[string.char(134)] = string.char(218),\n\t[string.char(135)] = string.char(219),\n\t[string.char(136)] = string.char(212),\n\t[string.char(137)] = string.char(213),\n\t[string.char(138)] = string.char(214),\n\t[string.char(139)] = string.char(215),\n\t[string.char(140)] = string.char(208),\n\t[string.char(141)] = string.char(209),\n\t[string.char(142)] = string.char(210),\n\t[string.char(143)] = string.char(211),\n\t[string.char(144)] = string.char(204),\n\t[string.char(145)] = string.char(205),\n\t[string.char(146)] = string.char(206),\n\t[string.char(147)] = string.char(207),\n\t[string.char(148)] = string.char(200),\n\t[string.char(149)] = string.char(201),\n\t[string.char(150)] = string.char(202),\n\t[string.char(151)] = string.char(203),\n\t[string.char(152)] = string.char(196),\n\t[string.char(153)] = string.char(197),\n\t[string.char(154)] = string.char(198),\n\t[string.char(155)] = string.char(199),\n\t[string.char(156)] = string.char(192),\n\t[string.char(157)] = string.char(193),\n\t[string.char(158)] = string.char(194),\n\t[string.char(159)] = string.char(195),\n\t[string.char(160)] = string.char(252),\n\t[string.char(161)] = string.char(253),\n\t[string.char(162)] = string.char(254),\n\t[string.char(163)] = string.char(255),\n\t[string.char(164)] = string.char(248),\n\t[string.char(165)] = string.char(249),\n\t[string.char(166)] = string.char(250),\n\t[string.char(167)] = string.char(251),\n\t[string.char(168)] = string.char(244),\n\t[string.char(169)] = string.char(245),\n\t[string.char(170)] = string.char(246),\n\t[string.char(171)] = string.char(247),\n\t[string.char(172)] = string.char(240),\n\t[string.char(173)] = string.char(241),\n\t[string.char(174)] = string.char(242),\n\t[string.char(175)] = string.char(243),\n\t[string.char(176)] = string.char(236),\n\t[string.char(177)] = string.char(237),\n\t[string.char(178)] = string.char(238),\n\t[string.char(179)] = string.char(239),\n\t[string.char(180)] = string.char(232),\n\t[string.char(181)] = string.char(233),\n\t[string.char(182)] = string.char(234),\n\t[string.char(183)] = string.char(235),\n\t[string.char(184)] = string.char(228),\n\t[string.char(185)] = string.char(229),\n\t[string.char(186)] = string.char(230),\n\t[string.char(187)] = string.char(231),\n\t[string.char(188)] = string.char(224),\n\t[string.char(189)] = string.char(225),\n\t[string.char(190)] = string.char(226),\n\t[string.char(191)] = string.char(227),\n\t[string.char(192)] = string.char(156),\n\t[string.char(193)] = string.char(157),\n\t[string.char(194)] = string.char(158),\n\t[string.char(195)] = string.char(159),\n\t[string.char(196)] = string.char(152),\n\t[string.char(197)] = string.char(153),\n\t[string.char(198)] = string.char(154),\n\t[string.char(199)] = string.char(155),\n\t[string.char(200)] = string.char(148),\n\t[string.char(201)] = string.char(149),\n\t[string.char(202)] = string.char(150),\n\t[string.char(203)] = string.char(151),\n\t[string.char(204)] = string.char(144),\n\t[string.char(205)] = string.char(145),\n\t[string.char(206)] = string.char(146),\n\t[string.char(207)] = string.char(147),\n\t[string.char(208)] = string.char(140),\n\t[string.char(209)] = string.char(141),\n\t[string.char(210)] = string.char(142),\n\t[string.char(211)] = string.char(143),\n\t[string.char(212)] = string.char(136),\n\t[string.char(213)] = string.char(137),\n\t[string.char(214)] = string.char(138),\n\t[string.char(215)] = string.char(139),\n\t[string.char(216)] = string.char(132),\n\t[string.char(217)] = string.char(133),\n\t[string.char(218)] = string.char(134),\n\t[string.char(219)] = string.char(135),\n\t[string.char(220)] = string.char(128),\n\t[string.char(221)] = string.char(129),\n\t[string.char(222)] = string.char(130),\n\t[string.char(223)] = string.char(131),\n\t[string.char(224)] = string.char(188),\n\t[string.char(225)] = string.char(189),\n\t[string.char(226)] = string.char(190),\n\t[string.char(227)] = string.char(191),\n\t[string.char(228)] = string.char(184),\n\t[string.char(229)] = string.char(185),\n\t[string.char(230)] = string.char(186),\n\t[string.char(231)] = string.char(187),\n\t[string.char(232)] = string.char(180),\n\t[string.char(233)] = string.char(181),\n\t[string.char(234)] = string.char(182),\n\t[string.char(235)] = string.char(183),\n\t[string.char(236)] = string.char(176),\n\t[string.char(237)] = string.char(177),\n\t[string.char(238)] = string.char(178),\n\t[string.char(239)] = string.char(179),\n\t[string.char(240)] = string.char(172),\n\t[string.char(241)] = string.char(173),\n\t[string.char(242)] = string.char(174),\n\t[string.char(243)] = string.char(175),\n\t[string.char(244)] = string.char(168),\n\t[string.char(245)] = string.char(169),\n\t[string.char(246)] = string.char(170),\n\t[string.char(247)] = string.char(171),\n\t[string.char(248)] = string.char(164),\n\t[string.char(249)] = string.char(165),\n\t[string.char(250)] = string.char(166),\n\t[string.char(251)] = string.char(167),\n\t[string.char(252)] = string.char(160),\n\t[string.char(253)] = string.char(161),\n\t[string.char(254)] = string.char(162),\n\t[string.char(255)] = string.char(163),\n}\n\nlocal xor_with_0x36 = {\n\t[string.char(0)] = string.char(54),\n\t[string.char(1)] = string.char(55),\n\t[string.char(2)] = string.char(52),\n\t[string.char(3)] = string.char(53),\n\t[string.char(4)] = string.char(50),\n\t[string.char(5)] = string.char(51),\n\t[string.char(6)] = string.char(48),\n\t[string.char(7)] = string.char(49),\n\t[string.char(8)] = string.char(62),\n\t[string.char(9)] = string.char(63),\n\t[string.char(10)] = string.char(60),\n\t[string.char(11)] = string.char(61),\n\t[string.char(12)] = string.char(58),\n\t[string.char(13)] = string.char(59),\n\t[string.char(14)] = string.char(56),\n\t[string.char(15)] = string.char(57),\n\t[string.char(16)] = string.char(38),\n\t[string.char(17)] = string.char(39),\n\t[string.char(18)] = string.char(36),\n\t[string.char(19)] = string.char(37),\n\t[string.char(20)] = string.char(34),\n\t[string.char(21)] = string.char(35),\n\t[string.char(22)] = string.char(32),\n\t[string.char(23)] = string.char(33),\n\t[string.char(24)] = string.char(46),\n\t[string.char(25)] = string.char(47),\n\t[string.char(26)] = string.char(44),\n\t[string.char(27)] = string.char(45),\n\t[string.char(28)] = string.char(42),\n\t[string.char(29)] = string.char(43),\n\t[string.char(30)] = string.char(40),\n\t[string.char(31)] = string.char(41),\n\t[string.char(32)] = string.char(22),\n\t[string.char(33)] = string.char(23),\n\t[string.char(34)] = string.char(20),\n\t[string.char(35)] = string.char(21),\n\t[string.char(36)] = string.char(18),\n\t[string.char(37)] = string.char(19),\n\t[string.char(38)] = string.char(16),\n\t[string.char(39)] = string.char(17),\n\t[string.char(40)] = string.char(30),\n\t[string.char(41)] = string.char(31),\n\t[string.char(42)] = string.char(28),\n\t[string.char(43)] = string.char(29),\n\t[string.char(44)] = string.char(26),\n\t[string.char(45)] = string.char(27),\n\t[string.char(46)] = string.char(24),\n\t[string.char(47)] = string.char(25),\n\t[string.char(48)] = string.char(6),\n\t[string.char(49)] = string.char(7),\n\t[string.char(50)] = string.char(4),\n\t[string.char(51)] = string.char(5),\n\t[string.char(52)] = string.char(2),\n\t[string.char(53)] = string.char(3),\n\t[string.char(54)] = string.char(0),\n\t[string.char(55)] = string.char(1),\n\t[string.char(56)] = string.char(14),\n\t[string.char(57)] = string.char(15),\n\t[string.char(58)] = string.char(12),\n\t[string.char(59)] = string.char(13),\n\t[string.char(60)] = string.char(10),\n\t[string.char(61)] = string.char(11),\n\t[string.char(62)] = string.char(8),\n\t[string.char(63)] = string.char(9),\n\t[string.char(64)] = string.char(118),\n\t[string.char(65)] = string.char(119),\n\t[string.char(66)] = string.char(116),\n\t[string.char(67)] = string.char(117),\n\t[string.char(68)] = string.char(114),\n\t[string.char(69)] = string.char(115),\n\t[string.char(70)] = string.char(112),\n\t[string.char(71)] = string.char(113),\n\t[string.char(72)] = string.char(126),\n\t[string.char(73)] = string.char(127),\n\t[string.char(74)] = string.char(124),\n\t[string.char(75)] = string.char(125),\n\t[string.char(76)] = string.char(122),\n\t[string.char(77)] = string.char(123),\n\t[string.char(78)] = string.char(120),\n\t[string.char(79)] = string.char(121),\n\t[string.char(80)] = string.char(102),\n\t[string.char(81)] = string.char(103),\n\t[string.char(82)] = string.char(100),\n\t[string.char(83)] = string.char(101),\n\t[string.char(84)] = string.char(98),\n\t[string.char(85)] = string.char(99),\n\t[string.char(86)] = string.char(96),\n\t[string.char(87)] = string.char(97),\n\t[string.char(88)] = string.char(110),\n\t[string.char(89)] = string.char(111),\n\t[string.char(90)] = string.char(108),\n\t[string.char(91)] = string.char(109),\n\t[string.char(92)] = string.char(106),\n\t[string.char(93)] = string.char(107),\n\t[string.char(94)] = string.char(104),\n\t[string.char(95)] = string.char(105),\n\t[string.char(96)] = string.char(86),\n\t[string.char(97)] = string.char(87),\n\t[string.char(98)] = string.char(84),\n\t[string.char(99)] = string.char(85),\n\t[string.char(100)] = string.char(82),\n\t[string.char(101)] = string.char(83),\n\t[string.char(102)] = string.char(80),\n\t[string.char(103)] = string.char(81),\n\t[string.char(104)] = string.char(94),\n\t[string.char(105)] = string.char(95),\n\t[string.char(106)] = string.char(92),\n\t[string.char(107)] = string.char(93),\n\t[string.char(108)] = string.char(90),\n\t[string.char(109)] = string.char(91),\n\t[string.char(110)] = string.char(88),\n\t[string.char(111)] = string.char(89),\n\t[string.char(112)] = string.char(70),\n\t[string.char(113)] = string.char(71),\n\t[string.char(114)] = string.char(68),\n\t[string.char(115)] = string.char(69),\n\t[string.char(116)] = string.char(66),\n\t[string.char(117)] = string.char(67),\n\t[string.char(118)] = string.char(64),\n\t[string.char(119)] = string.char(65),\n\t[string.char(120)] = string.char(78),\n\t[string.char(121)] = string.char(79),\n\t[string.char(122)] = string.char(76),\n\t[string.char(123)] = string.char(77),\n\t[string.char(124)] = string.char(74),\n\t[string.char(125)] = string.char(75),\n\t[string.char(126)] = string.char(72),\n\t[string.char(127)] = string.char(73),\n\t[string.char(128)] = string.char(182),\n\t[string.char(129)] = string.char(183),\n\t[string.char(130)] = string.char(180),\n\t[string.char(131)] = string.char(181),\n\t[string.char(132)] = string.char(178),\n\t[string.char(133)] = string.char(179),\n\t[string.char(134)] = string.char(176),\n\t[string.char(135)] = string.char(177),\n\t[string.char(136)] = string.char(190),\n\t[string.char(137)] = string.char(191),\n\t[string.char(138)] = string.char(188),\n\t[string.char(139)] = string.char(189),\n\t[string.char(140)] = string.char(186),\n\t[string.char(141)] = string.char(187),\n\t[string.char(142)] = string.char(184),\n\t[string.char(143)] = string.char(185),\n\t[string.char(144)] = string.char(166),\n\t[string.char(145)] = string.char(167),\n\t[string.char(146)] = string.char(164),\n\t[string.char(147)] = string.char(165),\n\t[string.char(148)] = string.char(162),\n\t[string.char(149)] = string.char(163),\n\t[string.char(150)] = string.char(160),\n\t[string.char(151)] = string.char(161),\n\t[string.char(152)] = string.char(174),\n\t[string.char(153)] = string.char(175),\n\t[string.char(154)] = string.char(172),\n\t[string.char(155)] = string.char(173),\n\t[string.char(156)] = string.char(170),\n\t[string.char(157)] = string.char(171),\n\t[string.char(158)] = string.char(168),\n\t[string.char(159)] = string.char(169),\n\t[string.char(160)] = string.char(150),\n\t[string.char(161)] = string.char(151),\n\t[string.char(162)] = string.char(148),\n\t[string.char(163)] = string.char(149),\n\t[string.char(164)] = string.char(146),\n\t[string.char(165)] = string.char(147),\n\t[string.char(166)] = string.char(144),\n\t[string.char(167)] = string.char(145),\n\t[string.char(168)] = string.char(158),\n\t[string.char(169)] = string.char(159),\n\t[string.char(170)] = string.char(156),\n\t[string.char(171)] = string.char(157),\n\t[string.char(172)] = string.char(154),\n\t[string.char(173)] = string.char(155),\n\t[string.char(174)] = string.char(152),\n\t[string.char(175)] = string.char(153),\n\t[string.char(176)] = string.char(134),\n\t[string.char(177)] = string.char(135),\n\t[string.char(178)] = string.char(132),\n\t[string.char(179)] = string.char(133),\n\t[string.char(180)] = string.char(130),\n\t[string.char(181)] = string.char(131),\n\t[string.char(182)] = string.char(128),\n\t[string.char(183)] = string.char(129),\n\t[string.char(184)] = string.char(142),\n\t[string.char(185)] = string.char(143),\n\t[string.char(186)] = string.char(140),\n\t[string.char(187)] = string.char(141),\n\t[string.char(188)] = string.char(138),\n\t[string.char(189)] = string.char(139),\n\t[string.char(190)] = string.char(136),\n\t[string.char(191)] = string.char(137),\n\t[string.char(192)] = string.char(246),\n\t[string.char(193)] = string.char(247),\n\t[string.char(194)] = string.char(244),\n\t[string.char(195)] = string.char(245),\n\t[string.char(196)] = string.char(242),\n\t[string.char(197)] = string.char(243),\n\t[string.char(198)] = string.char(240),\n\t[string.char(199)] = string.char(241),\n\t[string.char(200)] = string.char(254),\n\t[string.char(201)] = string.char(255),\n\t[string.char(202)] = string.char(252),\n\t[string.char(203)] = string.char(253),\n\t[string.char(204)] = string.char(250),\n\t[string.char(205)] = string.char(251),\n\t[string.char(206)] = string.char(248),\n\t[string.char(207)] = string.char(249),\n\t[string.char(208)] = string.char(230),\n\t[string.char(209)] = string.char(231),\n\t[string.char(210)] = string.char(228),\n\t[string.char(211)] = string.char(229),\n\t[string.char(212)] = string.char(226),\n\t[string.char(213)] = string.char(227),\n\t[string.char(214)] = string.char(224),\n\t[string.char(215)] = string.char(225),\n\t[string.char(216)] = string.char(238),\n\t[string.char(217)] = string.char(239),\n\t[string.char(218)] = string.char(236),\n\t[string.char(219)] = string.char(237),\n\t[string.char(220)] = string.char(234),\n\t[string.char(221)] = string.char(235),\n\t[string.char(222)] = string.char(232),\n\t[string.char(223)] = string.char(233),\n\t[string.char(224)] = string.char(214),\n\t[string.char(225)] = string.char(215),\n\t[string.char(226)] = string.char(212),\n\t[string.char(227)] = string.char(213),\n\t[string.char(228)] = string.char(210),\n\t[string.char(229)] = string.char(211),\n\t[string.char(230)] = string.char(208),\n\t[string.char(231)] = string.char(209),\n\t[string.char(232)] = string.char(222),\n\t[string.char(233)] = string.char(223),\n\t[string.char(234)] = string.char(220),\n\t[string.char(235)] = string.char(221),\n\t[string.char(236)] = string.char(218),\n\t[string.char(237)] = string.char(219),\n\t[string.char(238)] = string.char(216),\n\t[string.char(239)] = string.char(217),\n\t[string.char(240)] = string.char(198),\n\t[string.char(241)] = string.char(199),\n\t[string.char(242)] = string.char(196),\n\t[string.char(243)] = string.char(197),\n\t[string.char(244)] = string.char(194),\n\t[string.char(245)] = string.char(195),\n\t[string.char(246)] = string.char(192),\n\t[string.char(247)] = string.char(193),\n\t[string.char(248)] = string.char(206),\n\t[string.char(249)] = string.char(207),\n\t[string.char(250)] = string.char(204),\n\t[string.char(251)] = string.char(205),\n\t[string.char(252)] = string.char(202),\n\t[string.char(253)] = string.char(203),\n\t[string.char(254)] = string.char(200),\n\t[string.char(255)] = string.char(201),\n}\n\n-------------------------------------------------------------------------\n\nfunction sha256.sha256(msg)\n\tmsg = preproc(msg, #msg)\n\tlocal H = initH256( { })\n\tfor i = 1, #msg, 64 do digestblock(msg, i, H) end\n\treturn str2hexa(num2s(H[1], 4) .. num2s(H[2], 4) .. num2s(H[3], 4) .. num2s(H[4], 4) ..\n\tnum2s(H[5], 4) .. num2s(H[6], 4) .. num2s(H[7], 4) .. num2s(H[8], 4))\nend\n\nfunction sha256.sha256_binary(msg)\n\treturn hex_to_binary(sha256.sha256(msg))\nend\n\nfunction sha256.hmac_sha256(key, text)\n\tassert(type(key) == 'string', \"key passed to hmac_sha256 should be a string\")\n\tassert(type(text) == 'string', \"text passed to hmac_sha256 should be a string\")\n\n\tif #key > blocksize then\n\t\tkey = sha256.sha256_binary(key)\n\tend\n\n\tlocal key_xord_with_0x36 = key:gsub('.', xor_with_0x36) .. string.rep(string.char(0x36), blocksize - #key)\n\tlocal key_xord_with_0x5c = key:gsub('.', xor_with_0x5c) .. string.rep(string.char(0x5c), blocksize - #key)\n\n\treturn sha256.sha256(key_xord_with_0x5c .. sha256.sha256_binary(key_xord_with_0x36 .. text))\nend\n\n\nlocal index_table = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\n\nfunction to_binary(integer)\n    local remaining = tonumber(integer)\n    local bin_bits = ''\n\n    for i = 7, 0, -1 do\n        local current_power = math.pow(2, i)\n\n        if remaining >= current_power then\n            bin_bits = bin_bits .. '1'\n            remaining = remaining - current_power\n        else\n            bin_bits = bin_bits .. '0'\n        end\n    end\n\n    return bin_bits\nend\n\n\nfunction from_binary(bin_bits)\n    return tonumber(bin_bits, 2)\nend\n\n\nfunction to_base64(to_encode)\n    local bit_pattern = ''\n    local encoded = ''\n    local trailing = ''\n\n    for i = 1, string.len(to_encode) do\n        bit_pattern = bit_pattern .. to_binary(string.byte(string.sub(to_encode, i, i)))\n    end\n\n    -- Check the number of bytes. If it's not evenly divisible by three,\n    -- zero-pad the ending & append on the correct number of ``=``s.\n    if string.len(bit_pattern) % 3 == 2 then\n        trailing = '=='\n        bit_pattern = bit_pattern .. '0000000000000000'\n    elseif string.len(bit_pattern) % 3 == 1 then\n        trailing = '='\n        bit_pattern = bit_pattern .. '00000000'\n    end\n\n    for i = 1, string.len(bit_pattern), 6 do\n        local byte = string.sub(bit_pattern, i, i+5)\n        local offset = tonumber(from_binary(byte))\n        encoded = encoded .. string.sub(index_table, offset+1, offset+1)\n    end\n\n    return string.sub(encoded, 1, -1 - string.len(trailing)) .. trailing\nend\n\n\n--function urlencode(u) \n--\treturn u --:gsub(\"=\", '%%%%3b')\n--end\n\nhmac = sha256.hmac_sha256(code, ts)\nlocal b64_hmac = urlencode(to_base64(hex_to_binary(hmac)))\nfibaro:debug(b64_hmac)\nlocal params = \"identifier=\" .. identifier .. \"&hash=\" .. b64_hmac .. \"&ts=\" .. ts\n--fibaro:debug(\"params: \" .. params)\n-- http://<ip>/open\n\n\nIP = fibaro:get(fibaro:getSelfId(), \"IPAddress\")\nfibaro:debug(\"IP: \"..IP)\nlocal gw = Net.FHttp(IP, 80)\nres = gw:POST(\"/open\", params ) ;\n--res = gw:GET(\"/status\") ;\n\nfibaro:debug(\"response: \"..res)\n","buttonIcon":1009,"favourite":false,"main":false}]},{"type":"label","elements":[{"id":3,"lua":false,"waitForResponse":false,"caption":"Status:","name":"LabelStatus","favourite":false,"main":false}]},{"type":"button","elements":[{"id":4,"lua":true,"waitForResponse":false,"caption":"Status","name":"ButtonStatus","empty":false,"msg":"--[[\n%% properties\n%% globals\n--]]\n\nidentifier = fibaro:getGlobalValue('lockeridentifier'..fibaro:getSelfId());\ncode = fibaro:getGlobalValue('locker_code'..fibaro:getSelfId());\nts = \"\"..os.time()\n\nlocal sha256 = { }\n\nlocal MOD = 2 ^ 32\nlocal MODM = MOD - 1\n \n \nfunction floor(n) \n  return n - (n % 1)\nend\n\nfunction bxor1 (a,b)\n  local r = 0\n  for i = 0, 31 do\n    local x = a / 2 + b / 2\n    if x ~= floor(x) then\n      r = r + 2^i\n    end\n    a = floor(a / 2)\n    b = floor(b / 2)\n  end\n  return r\nend \n \nlocal function bxor(a, b, c, ...)\n\tlocal z = nil\n\tif b then\n\t\ta = a % MOD\n\t\tb = b % MOD\n\t\tz = bxor1(a, b)\n\t\tif c then z = bxor(z, c, ...) end\n\t\treturn z\n\telseif a then\n\t\treturn a % MOD\n\telse\n\t\treturn 0\n\tend\nend\n \nlocal function band(a, b, c, ...)\n\tlocal z\n\tif b then\n\t\ta = a % MOD\n\t\tb = b % MOD\n\t\tz =((a + b) - bxor1(a, b)) / 2\n\t\tif c then z = bit32_band(z, c, ...) end\n\t\treturn z\n\telseif a then\n\t\treturn a % MOD\n\telse\n\t\treturn MODM\n\tend\nend\n \nlocal function bnot(x) return(-1 - x) % MOD end\n \nlocal function rshift1(a, disp)\n\tif disp < 0 then return lshift(a, - disp) end\n\treturn math.floor(a % 2 ^ 32 / 2 ^ disp)\nend\n \nlocal function rshift(x, disp)\n\tif disp > 31 or disp < -31 then return 0 end\n\treturn rshift1(x % MOD, disp)\nend\n \nlocal function lshift(a, disp)\n\tif disp < 0 then return rshift(a, - disp) end\n\treturn(a * 2 ^ disp) % 2 ^ 32\nend\n \nlocal function rrotate(x, disp)\n\tx = x % MOD\n\tdisp = disp % 32\n\tlocal low = band(x, 2 ^ disp - 1)\n\treturn rshift(x, disp) + lshift(low, 32 - disp)\nend\n \nlocal k = {\n\t0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,\n\t0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,\n\t0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,\n\t0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,\n\t0xe49b69c1,0xefbe4786,0x0fc19dc6,0x240ca1cc,\n\t0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,\n\t0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,\n\t0xc6e00bf3,0xd5a79147,0x06ca6351,0x14292967,\n\t0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,\n\t0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,\n\t0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,\n\t0xd192e819,0xd6990624,0xf40e3585,0x106aa070,\n\t0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,\n\t0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,\n\t0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,\n\t0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2,\n}\n \nlocal function str2hexa(s)\n\treturn(string.gsub(s, \".\", function(c) return string.format(\"%02x\", string.byte(c)) end))\nend\n \nlocal function num2s(l, n)\n\tlocal s = \"\"\n\tfor i = 1, n do\n\t\tlocal rem = l % 256\n\t\ts = string.char(rem) .. s\n\t\tl =(l - rem) / 256\n\tend\n\treturn s\nend\n \nlocal function s232num(s, i)\n\tlocal n = 0\n\tfor i = i, i + 3 do n = n * 256 + string.byte(s, i) end\n\treturn n\nend\n \nlocal function preproc(msg, len)\n\tlocal extra = 64 -((len + 9) % 64)\n\tlen = num2s(8 * len, 8)\n\tmsg = msg .. \"\\128\" .. string.rep(\"\\0\", extra) .. len\n\tassert(#msg % 64 == 0)\n\treturn msg\nend\n \nlocal function initH256(H)\n\tH[1] = 0x6a09e667\n\tH[2] = 0xbb67ae85\n\tH[3] = 0x3c6ef372\n\tH[4] = 0xa54ff53a\n\tH[5] = 0x510e527f\n\tH[6] = 0x9b05688c\n\tH[7] = 0x1f83d9ab\n\tH[8] = 0x5be0cd19\n\treturn H\nend\n \nlocal function digestblock(msg, i, H)\n\tlocal w = { }\n\tfor j = 1, 16 do w[j] = s232num(msg, i +(j - 1) * 4) end\n\tfor j = 17, 64 do\n\t\tlocal v = w[j - 15]\n\t\tlocal s0 = bxor(rrotate(v, 7), rrotate(v, 18), rshift(v, 3))\n\t\tv = w[j - 2]\n\t\tw[j] = w[j - 16] + s0 + w[j - 7] + bxor(rrotate(v, 17), rrotate(v, 19), rshift(v, 10))\n\tend\n\n\tlocal a, b, c, d, e, f, g, h = H[1], H[2], H[3], H[4], H[5], H[6], H[7], H[8]\n\tfor i = 1, 64 do\n\t\tlocal s0 = bxor(rrotate(a, 2), rrotate(a, 13), rrotate(a, 22))\n\t\tlocal maj = bxor(band(a, b), band(a, c), band(b, c))\n\t\tlocal t2 = s0 + maj\n\t\tlocal s1 = bxor(rrotate(e, 6), rrotate(e, 11), rrotate(e, 25))\n\t\tlocal ch = bxor(band(e, f), band(bnot(e), g))\n\t\tlocal t1 = h + s1 + ch + k[i] + w[i]\n\t\th, g, f, e, d, c, b, a = g, f, e, d + t1, c, b, a, t1 + t2\n\tend\n\n\tH[1] = band(H[1] + a)\n\tH[2] = band(H[2] + b)\n\tH[3] = band(H[3] + c)\n\tH[4] = band(H[4] + d)\n\tH[5] = band(H[5] + e)\n\tH[6] = band(H[6] + f)\n\tH[7] = band(H[7] + g)\n\tH[8] = band(H[8] + h)\nend\n\nlocal function hex_to_binary(hex)\n\treturn hex:gsub('..', function(hexval)\n\t\treturn string.char(tonumber(hexval, 16))\n\tend )\nend\n\nlocal blocksize = 64 -- 512 bits\n\nlocal xor_with_0x5c = {\n\t[string.char(0)] = string.char(92),\n\t[string.char(1)] = string.char(93),\n\t[string.char(2)] = string.char(94),\n\t[string.char(3)] = string.char(95),\n\t[string.char(4)] = string.char(88),\n\t[string.char(5)] = string.char(89),\n\t[string.char(6)] = string.char(90),\n\t[string.char(7)] = string.char(91),\n\t[string.char(8)] = string.char(84),\n\t[string.char(9)] = string.char(85),\n\t[string.char(10)] = string.char(86),\n\t[string.char(11)] = string.char(87),\n\t[string.char(12)] = string.char(80),\n\t[string.char(13)] = string.char(81),\n\t[string.char(14)] = string.char(82),\n\t[string.char(15)] = string.char(83),\n\t[string.char(16)] = string.char(76),\n\t[string.char(17)] = string.char(77),\n\t[string.char(18)] = string.char(78),\n\t[string.char(19)] = string.char(79),\n\t[string.char(20)] = string.char(72),\n\t[string.char(21)] = string.char(73),\n\t[string.char(22)] = string.char(74),\n\t[string.char(23)] = string.char(75),\n\t[string.char(24)] = string.char(68),\n\t[string.char(25)] = string.char(69),\n\t[string.char(26)] = string.char(70),\n\t[string.char(27)] = string.char(71),\n\t[string.char(28)] = string.char(64),\n\t[string.char(29)] = string.char(65),\n\t[string.char(30)] = string.char(66),\n\t[string.char(31)] = string.char(67),\n\t[string.char(32)] = string.char(124),\n\t[string.char(33)] = string.char(125),\n\t[string.char(34)] = string.char(126),\n\t[string.char(35)] = string.char(127),\n\t[string.char(36)] = string.char(120),\n\t[string.char(37)] = string.char(121),\n\t[string.char(38)] = string.char(122),\n\t[string.char(39)] = string.char(123),\n\t[string.char(40)] = string.char(116),\n\t[string.char(41)] = string.char(117),\n\t[string.char(42)] = string.char(118),\n\t[string.char(43)] = string.char(119),\n\t[string.char(44)] = string.char(112),\n\t[string.char(45)] = string.char(113),\n\t[string.char(46)] = string.char(114),\n\t[string.char(47)] = string.char(115),\n\t[string.char(48)] = string.char(108),\n\t[string.char(49)] = string.char(109),\n\t[string.char(50)] = string.char(110),\n\t[string.char(51)] = string.char(111),\n\t[string.char(52)] = string.char(104),\n\t[string.char(53)] = string.char(105),\n\t[string.char(54)] = string.char(106),\n\t[string.char(55)] = string.char(107),\n\t[string.char(56)] = string.char(100),\n\t[string.char(57)] = string.char(101),\n\t[string.char(58)] = string.char(102),\n\t[string.char(59)] = string.char(103),\n\t[string.char(60)] = string.char(96),\n\t[string.char(61)] = string.char(97),\n\t[string.char(62)] = string.char(98),\n\t[string.char(63)] = string.char(99),\n\t[string.char(64)] = string.char(28),\n\t[string.char(65)] = string.char(29),\n\t[string.char(66)] = string.char(30),\n\t[string.char(67)] = string.char(31),\n\t[string.char(68)] = string.char(24),\n\t[string.char(69)] = string.char(25),\n\t[string.char(70)] = string.char(26),\n\t[string.char(71)] = string.char(27),\n\t[string.char(72)] = string.char(20),\n\t[string.char(73)] = string.char(21),\n\t[string.char(74)] = string.char(22),\n\t[string.char(75)] = string.char(23),\n\t[string.char(76)] = string.char(16),\n\t[string.char(77)] = string.char(17),\n\t[string.char(78)] = string.char(18),\n\t[string.char(79)] = string.char(19),\n\t[string.char(80)] = string.char(12),\n\t[string.char(81)] = string.char(13),\n\t[string.char(82)] = string.char(14),\n\t[string.char(83)] = string.char(15),\n\t[string.char(84)] = string.char(8),\n\t[string.char(85)] = string.char(9),\n\t[string.char(86)] = string.char(10),\n\t[string.char(87)] = string.char(11),\n\t[string.char(88)] = string.char(4),\n\t[string.char(89)] = string.char(5),\n\t[string.char(90)] = string.char(6),\n\t[string.char(91)] = string.char(7),\n\t[string.char(92)] = string.char(0),\n\t[string.char(93)] = string.char(1),\n\t[string.char(94)] = string.char(2),\n\t[string.char(95)] = string.char(3),\n\t[string.char(96)] = string.char(60),\n\t[string.char(97)] = string.char(61),\n\t[string.char(98)] = string.char(62),\n\t[string.char(99)] = string.char(63),\n\t[string.char(100)] = string.char(56),\n\t[string.char(101)] = string.char(57),\n\t[string.char(102)] = string.char(58),\n\t[string.char(103)] = string.char(59),\n\t[string.char(104)] = string.char(52),\n\t[string.char(105)] = string.char(53),\n\t[string.char(106)] = string.char(54),\n\t[string.char(107)] = string.char(55),\n\t[string.char(108)] = string.char(48),\n\t[string.char(109)] = string.char(49),\n\t[string.char(110)] = string.char(50),\n\t[string.char(111)] = string.char(51),\n\t[string.char(112)] = string.char(44),\n\t[string.char(113)] = string.char(45),\n\t[string.char(114)] = string.char(46),\n\t[string.char(115)] = string.char(47),\n\t[string.char(116)] = string.char(40),\n\t[string.char(117)] = string.char(41),\n\t[string.char(118)] = string.char(42),\n\t[string.char(119)] = string.char(43),\n\t[string.char(120)] = string.char(36),\n\t[string.char(121)] = string.char(37),\n\t[string.char(122)] = string.char(38),\n\t[string.char(123)] = string.char(39),\n\t[string.char(124)] = string.char(32),\n\t[string.char(125)] = string.char(33),\n\t[string.char(126)] = string.char(34),\n\t[string.char(127)] = string.char(35),\n\t[string.char(128)] = string.char(220),\n\t[string.char(129)] = string.char(221),\n\t[string.char(130)] = string.char(222),\n\t[string.char(131)] = string.char(223),\n\t[string.char(132)] = string.char(216),\n\t[string.char(133)] = string.char(217),\n\t[string.char(134)] = string.char(218),\n\t[string.char(135)] = string.char(219),\n\t[string.char(136)] = string.char(212),\n\t[string.char(137)] = string.char(213),\n\t[string.char(138)] = string.char(214),\n\t[string.char(139)] = string.char(215),\n\t[string.char(140)] = string.char(208),\n\t[string.char(141)] = string.char(209),\n\t[string.char(142)] = string.char(210),\n\t[string.char(143)] = string.char(211),\n\t[string.char(144)] = string.char(204),\n\t[string.char(145)] = string.char(205),\n\t[string.char(146)] = string.char(206),\n\t[string.char(147)] = string.char(207),\n\t[string.char(148)] = string.char(200),\n\t[string.char(149)] = string.char(201),\n\t[string.char(150)] = string.char(202),\n\t[string.char(151)] = string.char(203),\n\t[string.char(152)] = string.char(196),\n\t[string.char(153)] = string.char(197),\n\t[string.char(154)] = string.char(198),\n\t[string.char(155)] = string.char(199),\n\t[string.char(156)] = string.char(192),\n\t[string.char(157)] = string.char(193),\n\t[string.char(158)] = string.char(194),\n\t[string.char(159)] = string.char(195),\n\t[string.char(160)] = string.char(252),\n\t[string.char(161)] = string.char(253),\n\t[string.char(162)] = string.char(254),\n\t[string.char(163)] = string.char(255),\n\t[string.char(164)] = string.char(248),\n\t[string.char(165)] = string.char(249),\n\t[string.char(166)] = string.char(250),\n\t[string.char(167)] = string.char(251),\n\t[string.char(168)] = string.char(244),\n\t[string.char(169)] = string.char(245),\n\t[string.char(170)] = string.char(246),\n\t[string.char(171)] = string.char(247),\n\t[string.char(172)] = string.char(240),\n\t[string.char(173)] = string.char(241),\n\t[string.char(174)] = string.char(242),\n\t[string.char(175)] = string.char(243),\n\t[string.char(176)] = string.char(236),\n\t[string.char(177)] = string.char(237),\n\t[string.char(178)] = string.char(238),\n\t[string.char(179)] = string.char(239),\n\t[string.char(180)] = string.char(232),\n\t[string.char(181)] = string.char(233),\n\t[string.char(182)] = string.char(234),\n\t[string.char(183)] = string.char(235),\n\t[string.char(184)] = string.char(228),\n\t[string.char(185)] = string.char(229),\n\t[string.char(186)] = string.char(230),\n\t[string.char(187)] = string.char(231),\n\t[string.char(188)] = string.char(224),\n\t[string.char(189)] = string.char(225),\n\t[string.char(190)] = string.char(226),\n\t[string.char(191)] = string.char(227),\n\t[string.char(192)] = string.char(156),\n\t[string.char(193)] = string.char(157),\n\t[string.char(194)] = string.char(158),\n\t[string.char(195)] = string.char(159),\n\t[string.char(196)] = string.char(152),\n\t[string.char(197)] = string.char(153),\n\t[string.char(198)] = string.char(154),\n\t[string.char(199)] = string.char(155),\n\t[string.char(200)] = string.char(148),\n\t[string.char(201)] = string.char(149),\n\t[string.char(202)] = string.char(150),\n\t[string.char(203)] = string.char(151),\n\t[string.char(204)] = string.char(144),\n\t[string.char(205)] = string.char(145),\n\t[string.char(206)] = string.char(146),\n\t[string.char(207)] = string.char(147),\n\t[string.char(208)] = string.char(140),\n\t[string.char(209)] = string.char(141),\n\t[string.char(210)] = string.char(142),\n\t[string.char(211)] = string.char(143),\n\t[string.char(212)] = string.char(136),\n\t[string.char(213)] = string.char(137),\n\t[string.char(214)] = string.char(138),\n\t[string.char(215)] = string.char(139),\n\t[string.char(216)] = string.char(132),\n\t[string.char(217)] = string.char(133),\n\t[string.char(218)] = string.char(134),\n\t[string.char(219)] = string.char(135),\n\t[string.char(220)] = string.char(128),\n\t[string.char(221)] = string.char(129),\n\t[string.char(222)] = string.char(130),\n\t[string.char(223)] = string.char(131),\n\t[string.char(224)] = string.char(188),\n\t[string.char(225)] = string.char(189),\n\t[string.char(226)] = string.char(190),\n\t[string.char(227)] = string.char(191),\n\t[string.char(228)] = string.char(184),\n\t[string.char(229)] = string.char(185),\n\t[string.char(230)] = string.char(186),\n\t[string.char(231)] = string.char(187),\n\t[string.char(232)] = string.char(180),\n\t[string.char(233)] = string.char(181),\n\t[string.char(234)] = string.char(182),\n\t[string.char(235)] = string.char(183),\n\t[string.char(236)] = string.char(176),\n\t[string.char(237)] = string.char(177),\n\t[string.char(238)] = string.char(178),\n\t[string.char(239)] = string.char(179),\n\t[string.char(240)] = string.char(172),\n\t[string.char(241)] = string.char(173),\n\t[string.char(242)] = string.char(174),\n\t[string.char(243)] = string.char(175),\n\t[string.char(244)] = string.char(168),\n\t[string.char(245)] = string.char(169),\n\t[string.char(246)] = string.char(170),\n\t[string.char(247)] = string.char(171),\n\t[string.char(248)] = string.char(164),\n\t[string.char(249)] = string.char(165),\n\t[string.char(250)] = string.char(166),\n\t[string.char(251)] = string.char(167),\n\t[string.char(252)] = string.char(160),\n\t[string.char(253)] = string.char(161),\n\t[string.char(254)] = string.char(162),\n\t[string.char(255)] = string.char(163),\n}\n\nlocal xor_with_0x36 = {\n\t[string.char(0)] = string.char(54),\n\t[string.char(1)] = string.char(55),\n\t[string.char(2)] = string.char(52),\n\t[string.char(3)] = string.char(53),\n\t[string.char(4)] = string.char(50),\n\t[string.char(5)] = string.char(51),\n\t[string.char(6)] = string.char(48),\n\t[string.char(7)] = string.char(49),\n\t[string.char(8)] = string.char(62),\n\t[string.char(9)] = string.char(63),\n\t[string.char(10)] = string.char(60),\n\t[string.char(11)] = string.char(61),\n\t[string.char(12)] = string.char(58),\n\t[string.char(13)] = string.char(59),\n\t[string.char(14)] = string.char(56),\n\t[string.char(15)] = string.char(57),\n\t[string.char(16)] = string.char(38),\n\t[string.char(17)] = string.char(39),\n\t[string.char(18)] = string.char(36),\n\t[string.char(19)] = string.char(37),\n\t[string.char(20)] = string.char(34),\n\t[string.char(21)] = string.char(35),\n\t[string.char(22)] = string.char(32),\n\t[string.char(23)] = string.char(33),\n\t[string.char(24)] = string.char(46),\n\t[string.char(25)] = string.char(47),\n\t[string.char(26)] = string.char(44),\n\t[string.char(27)] = string.char(45),\n\t[string.char(28)] = string.char(42),\n\t[string.char(29)] = string.char(43),\n\t[string.char(30)] = string.char(40),\n\t[string.char(31)] = string.char(41),\n\t[string.char(32)] = string.char(22),\n\t[string.char(33)] = string.char(23),\n\t[string.char(34)] = string.char(20),\n\t[string.char(35)] = string.char(21),\n\t[string.char(36)] = string.char(18),\n\t[string.char(37)] = string.char(19),\n\t[string.char(38)] = string.char(16),\n\t[string.char(39)] = string.char(17),\n\t[string.char(40)] = string.char(30),\n\t[string.char(41)] = string.char(31),\n\t[string.char(42)] = string.char(28),\n\t[string.char(43)] = string.char(29),\n\t[string.char(44)] = string.char(26),\n\t[string.char(45)] = string.char(27),\n\t[string.char(46)] = string.char(24),\n\t[string.char(47)] = string.char(25),\n\t[string.char(48)] = string.char(6),\n\t[string.char(49)] = string.char(7),\n\t[string.char(50)] = string.char(4),\n\t[string.char(51)] = string.char(5),\n\t[string.char(52)] = string.char(2),\n\t[string.char(53)] = string.char(3),\n\t[string.char(54)] = string.char(0),\n\t[string.char(55)] = string.char(1),\n\t[string.char(56)] = string.char(14),\n\t[string.char(57)] = string.char(15),\n\t[string.char(58)] = string.char(12),\n\t[string.char(59)] = string.char(13),\n\t[string.char(60)] = string.char(10),\n\t[string.char(61)] = string.char(11),\n\t[string.char(62)] = string.char(8),\n\t[string.char(63)] = string.char(9),\n\t[string.char(64)] = string.char(118),\n\t[string.char(65)] = string.char(119),\n\t[string.char(66)] = string.char(116),\n\t[string.char(67)] = string.char(117),\n\t[string.char(68)] = string.char(114),\n\t[string.char(69)] = string.char(115),\n\t[string.char(70)] = string.char(112),\n\t[string.char(71)] = string.char(113),\n\t[string.char(72)] = string.char(126),\n\t[string.char(73)] = string.char(127),\n\t[string.char(74)] = string.char(124),\n\t[string.char(75)] = string.char(125),\n\t[string.char(76)] = string.char(122),\n\t[string.char(77)] = string.char(123),\n\t[string.char(78)] = string.char(120),\n\t[string.char(79)] = string.char(121),\n\t[string.char(80)] = string.char(102),\n\t[string.char(81)] = string.char(103),\n\t[string.char(82)] = string.char(100),\n\t[string.char(83)] = string.char(101),\n\t[string.char(84)] = string.char(98),\n\t[string.char(85)] = string.char(99),\n\t[string.char(86)] = string.char(96),\n\t[string.char(87)] = string.char(97),\n\t[string.char(88)] = string.char(110),\n\t[string.char(89)] = string.char(111),\n\t[string.char(90)] = string.char(108),\n\t[string.char(91)] = string.char(109),\n\t[string.char(92)] = string.char(106),\n\t[string.char(93)] = string.char(107),\n\t[string.char(94)] = string.char(104),\n\t[string.char(95)] = string.char(105),\n\t[string.char(96)] = string.char(86),\n\t[string.char(97)] = string.char(87),\n\t[string.char(98)] = string.char(84),\n\t[string.char(99)] = string.char(85),\n\t[string.char(100)] = string.char(82),\n\t[string.char(101)] = string.char(83),\n\t[string.char(102)] = string.char(80),\n\t[string.char(103)] = string.char(81),\n\t[string.char(104)] = string.char(94),\n\t[string.char(105)] = string.char(95),\n\t[string.char(106)] = string.char(92),\n\t[string.char(107)] = string.char(93),\n\t[string.char(108)] = string.char(90),\n\t[string.char(109)] = string.char(91),\n\t[string.char(110)] = string.char(88),\n\t[string.char(111)] = string.char(89),\n\t[string.char(112)] = string.char(70),\n\t[string.char(113)] = string.char(71),\n\t[string.char(114)] = string.char(68),\n\t[string.char(115)] = string.char(69),\n\t[string.char(116)] = string.char(66),\n\t[string.char(117)] = string.char(67),\n\t[string.char(118)] = string.char(64),\n\t[string.char(119)] = string.char(65),\n\t[string.char(120)] = string.char(78),\n\t[string.char(121)] = string.char(79),\n\t[string.char(122)] = string.char(76),\n\t[string.char(123)] = string.char(77),\n\t[string.char(124)] = string.char(74),\n\t[string.char(125)] = string.char(75),\n\t[string.char(126)] = string.char(72),\n\t[string.char(127)] = string.char(73),\n\t[string.char(128)] = string.char(182),\n\t[string.char(129)] = string.char(183),\n\t[string.char(130)] = string.char(180),\n\t[string.char(131)] = string.char(181),\n\t[string.char(132)] = string.char(178),\n\t[string.char(133)] = string.char(179),\n\t[string.char(134)] = string.char(176),\n\t[string.char(135)] = string.char(177),\n\t[string.char(136)] = string.char(190),\n\t[string.char(137)] = string.char(191),\n\t[string.char(138)] = string.char(188),\n\t[string.char(139)] = string.char(189),\n\t[string.char(140)] = string.char(186),\n\t[string.char(141)] = string.char(187),\n\t[string.char(142)] = string.char(184),\n\t[string.char(143)] = string.char(185),\n\t[string.char(144)] = string.char(166),\n\t[string.char(145)] = string.char(167),\n\t[string.char(146)] = string.char(164),\n\t[string.char(147)] = string.char(165),\n\t[string.char(148)] = string.char(162),\n\t[string.char(149)] = string.char(163),\n\t[string.char(150)] = string.char(160),\n\t[string.char(151)] = string.char(161),\n\t[string.char(152)] = string.char(174),\n\t[string.char(153)] = string.char(175),\n\t[string.char(154)] = string.char(172),\n\t[string.char(155)] = string.char(173),\n\t[string.char(156)] = string.char(170),\n\t[string.char(157)] = string.char(171),\n\t[string.char(158)] = string.char(168),\n\t[string.char(159)] = string.char(169),\n\t[string.char(160)] = string.char(150),\n\t[string.char(161)] = string.char(151),\n\t[string.char(162)] = string.char(148),\n\t[string.char(163)] = string.char(149),\n\t[string.char(164)] = string.char(146),\n\t[string.char(165)] = string.char(147),\n\t[string.char(166)] = string.char(144),\n\t[string.char(167)] = string.char(145),\n\t[string.char(168)] = string.char(158),\n\t[string.char(169)] = string.char(159),\n\t[string.char(170)] = string.char(156),\n\t[string.char(171)] = string.char(157),\n\t[string.char(172)] = string.char(154),\n\t[string.char(173)] = string.char(155),\n\t[string.char(174)] = string.char(152),\n\t[string.char(175)] = string.char(153),\n\t[string.char(176)] = string.char(134),\n\t[string.char(177)] = string.char(135),\n\t[string.char(178)] = string.char(132),\n\t[string.char(179)] = string.char(133),\n\t[string.char(180)] = string.char(130),\n\t[string.char(181)] = string.char(131),\n\t[string.char(182)] = string.char(128),\n\t[string.char(183)] = string.char(129),\n\t[string.char(184)] = string.char(142),\n\t[string.char(185)] = string.char(143),\n\t[string.char(186)] = string.char(140),\n\t[string.char(187)] = string.char(141),\n\t[string.char(188)] = string.char(138),\n\t[string.char(189)] = string.char(139),\n\t[string.char(190)] = string.char(136),\n\t[string.char(191)] = string.char(137),\n\t[string.char(192)] = string.char(246),\n\t[string.char(193)] = string.char(247),\n\t[string.char(194)] = string.char(244),\n\t[string.char(195)] = string.char(245),\n\t[string.char(196)] = string.char(242),\n\t[string.char(197)] = string.char(243),\n\t[string.char(198)] = string.char(240),\n\t[string.char(199)] = string.char(241),\n\t[string.char(200)] = string.char(254),\n\t[string.char(201)] = string.char(255),\n\t[string.char(202)] = string.char(252),\n\t[string.char(203)] = string.char(253),\n\t[string.char(204)] = string.char(250),\n\t[string.char(205)] = string.char(251),\n\t[string.char(206)] = string.char(248),\n\t[string.char(207)] = string.char(249),\n\t[string.char(208)] = string.char(230),\n\t[string.char(209)] = string.char(231),\n\t[string.char(210)] = string.char(228),\n\t[string.char(211)] = string.char(229),\n\t[string.char(212)] = string.char(226),\n\t[string.char(213)] = string.char(227),\n\t[string.char(214)] = string.char(224),\n\t[string.char(215)] = string.char(225),\n\t[string.char(216)] = string.char(238),\n\t[string.char(217)] = string.char(239),\n\t[string.char(218)] = string.char(236),\n\t[string.char(219)] = string.char(237),\n\t[string.char(220)] = string.char(234),\n\t[string.char(221)] = string.char(235),\n\t[string.char(222)] = string.char(232),\n\t[string.char(223)] = string.char(233),\n\t[string.char(224)] = string.char(214),\n\t[string.char(225)] = string.char(215),\n\t[string.char(226)] = string.char(212),\n\t[string.char(227)] = string.char(213),\n\t[string.char(228)] = string.char(210),\n\t[string.char(229)] = string.char(211),\n\t[string.char(230)] = string.char(208),\n\t[string.char(231)] = string.char(209),\n\t[string.char(232)] = string.char(222),\n\t[string.char(233)] = string.char(223),\n\t[string.char(234)] = string.char(220),\n\t[string.char(235)] = string.char(221),\n\t[string.char(236)] = string.char(218),\n\t[string.char(237)] = string.char(219),\n\t[string.char(238)] = string.char(216),\n\t[string.char(239)] = string.char(217),\n\t[string.char(240)] = string.char(198),\n\t[string.char(241)] = string.char(199),\n\t[string.char(242)] = string.char(196),\n\t[string.char(243)] = string.char(197),\n\t[string.char(244)] = string.char(194),\n\t[string.char(245)] = string.char(195),\n\t[string.char(246)] = string.char(192),\n\t[string.char(247)] = string.char(193),\n\t[string.char(248)] = string.char(206),\n\t[string.char(249)] = string.char(207),\n\t[string.char(250)] = string.char(204),\n\t[string.char(251)] = string.char(205),\n\t[string.char(252)] = string.char(202),\n\t[string.char(253)] = string.char(203),\n\t[string.char(254)] = string.char(200),\n\t[string.char(255)] = string.char(201),\n}\n\n-------------------------------------------------------------------------\n\nfunction sha256.sha256(msg)\n\tmsg = preproc(msg, #msg)\n\tlocal H = initH256( { })\n\tfor i = 1, #msg, 64 do digestblock(msg, i, H) end\n\treturn str2hexa(num2s(H[1], 4) .. num2s(H[2], 4) .. num2s(H[3], 4) .. num2s(H[4], 4) ..\n\tnum2s(H[5], 4) .. num2s(H[6], 4) .. num2s(H[7], 4) .. num2s(H[8], 4))\nend\n\nfunction sha256.sha256_binary(msg)\n\treturn hex_to_binary(sha256.sha256(msg))\nend\n\nfunction sha256.hmac_sha256(key, text)\n\tassert(type(key) == 'string', \"key passed to hmac_sha256 should be a string\")\n\tassert(type(text) == 'string', \"text passed to hmac_sha256 should be a string\")\n\n\tif #key > blocksize then\n\t\tkey = sha256.sha256_binary(key)\n\tend\n\n\tlocal key_xord_with_0x36 = key:gsub('.', xor_with_0x36) .. string.rep(string.char(0x36), blocksize - #key)\n\tlocal key_xord_with_0x5c = key:gsub('.', xor_with_0x5c) .. string.rep(string.char(0x5c), blocksize - #key)\n\n\treturn sha256.sha256(key_xord_with_0x5c .. sha256.sha256_binary(key_xord_with_0x36 .. text))\nend\n\n\nlocal index_table = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\n\nfunction to_binary(integer)\n    local remaining = tonumber(integer)\n    local bin_bits = ''\n\n    for i = 7, 0, -1 do\n        local current_power = math.pow(2, i)\n\n        if remaining >= current_power then\n            bin_bits = bin_bits .. '1'\n            remaining = remaining - current_power\n        else\n            bin_bits = bin_bits .. '0'\n        end\n    end\n\n    return bin_bits\nend\n\n\nfunction from_binary(bin_bits)\n    return tonumber(bin_bits, 2)\nend\n\n\nfunction to_base64(to_encode)\n    local bit_pattern = ''\n    local encoded = ''\n    local trailing = ''\n\n    for i = 1, string.len(to_encode) do\n        bit_pattern = bit_pattern .. to_binary(string.byte(string.sub(to_encode, i, i)))\n    end\n\n    -- Check the number of bytes. If it's not evenly divisible by three,\n    -- zero-pad the ending & append on the correct number of ``=``s.\n    if string.len(bit_pattern) % 3 == 2 then\n        trailing = '=='\n        bit_pattern = bit_pattern .. '0000000000000000'\n    elseif string.len(bit_pattern) % 3 == 1 then\n        trailing = '='\n        bit_pattern = bit_pattern .. '00000000'\n    end\n\n    for i = 1, string.len(bit_pattern), 6 do\n        local byte = string.sub(bit_pattern, i, i+5)\n        local offset = tonumber(from_binary(byte))\n        encoded = encoded .. string.sub(index_table, offset+1, offset+1)\n    end\n\n    return string.sub(encoded, 1, -1 - string.len(trailing)) .. trailing\nend\n\n\n--function urlencode(u) \n--\treturn u --:gsub(\"=\", '%%%%3b')\n--end\n\nhmac = sha256.hmac_sha256(code, ts)\nlocal b64_hmac = urlencode(to_base64(hex_to_binary(hmac)))\nfibaro:debug(b64_hmac)\nlocal params = \"identifier=\" .. identifier .. \"&hash=\" .. b64_hmac .. \"&ts=\" .. ts\n--fibaro:debug(\"params: \" .. params)\n-- http://<ip>/open\n\n\nIP = fibaro:get(fibaro:getSelfId(), \"IPAddress\")\nfibaro:debug(\"IP: \"..IP)\nlocal gw = Net.FHttp(IP, 80)\nres = gw:POST(\"/locker_status\", params ) ;\n--res = gw:GET(\"/status\") ;\n--fibaro:call(fibaro:getSelfId(), \"setProperty\", \"ui.LabelStatus.value\", \"checking\");\nfibaro:debug(\"res: \"..res)\nresult = json.decode(res);\nres_code = result.code\nfibaro:debug(\"result: \" .. res_code)\nif(res_code == 49) then\n  status = \"Porte fermée\"\n  fibaro:call(fibaro:getSelfId(), \"setProperty\", \"currentIcon\", fibaro:getGlobal('locker_close_id_'..fibaro:getSelfId()))\nelse\n  status = \"Porte ouverte\"\n  fibaro:call(fibaro:getSelfId(), \"setProperty\", \"currentIcon\", fibaro:getGlobal('locker_open_id_'..fibaro:getSelfId()))\nend\nfibaro:call(fibaro:getSelfId(), \"setProperty\", \"ui.LabelStatus.value\", status)\n\n","buttonIcon":0,"favourite":false,"main":false}]}]},"actions":{"pressButton":1,"setSlider":2,"setProperty":2}}
